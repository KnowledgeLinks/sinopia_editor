/* bfe 2018-09-18 */
!function(){var e=function(){return this}();var t,o,r=function(e,t,o){"string"==typeof e?(2===arguments.length&&(o=t),r.modules||(r.modules={},r.payloads={}),r.payloads[e]=o,r.modules[e]=null):r.original?r.original.apply(window,arguments):(console.error("dropping module because define wasn't a string."),console.trace())},a=function(e,t,o){if("[object Array]"===Object.prototype.toString.call(t)){for(var r=[],i=0,d=t.length;i<d;++i){var n=s(e,t[i]);if(!n&&a.original)return a.original.apply(window,arguments);r.push(n)}o&&o.apply(null,r)}else{if("string"==typeof t){var l=s(e,t);return!l&&a.original?a.original.apply(window,arguments):(o&&o(),l)}if(a.original)return a.original.apply(window,arguments)}},i=function(e,t){if(-1!==t.indexOf("!")){var o=t.split("!");return i(e,o[0])+"!"+i(e,o[1])}if("."===t.charAt(0))for(t=e.split("/").slice(0,-1).join("/")+"/"+t;-1!==t.indexOf(".")&&r!==t;){var r=t;t=t.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}return t},s=function(e,t){var o;t=i(e,t);var s=r.modules[t];if(!s){if("function"==typeof(s=r.payloads[t])){var d={id:t,uri:"",exports:o={},packaged:!0};o=s(function(e,o){return a(t,e,o)},o,d)||d.exports,r.modules[t]=o,delete r.payloads[t]}s=r.modules[t]=o||s}return s};o=e,(t="bfe")&&(e[t]||(e[t]={}),o=e[t]),o.define&&o.define.packaged||(r.original=o.define,o.define=r,o.define.packaged=!0),o.require&&o.require.packaged||(a.original=o.require,o.require=function(e,t){return a("",e,t)},o.require.packaged=!0)}(),bfe.define("src/bfe",["require","exports","module","src/bfestore","src/bfelogging","src/lib/aceconfig"],function(e,t,o){var r,a={},s=e("src/bfestore"),n=e("src/bfelogging"),l=[],p=[],c={},u=[],f=1,b=0,g=0,h=[],m={"http://id.loc.gov/authorities/names":{name:"LCNAF",load:e("src/lookups/lcnames")},"http://id.loc.gov/authorities/subjects":{name:"LCSH",load:e("src/lookups/lcsubjects")},"http://id.loc.gov/authorities/genreForms":{name:"LCGFT",load:e("src/lookups/lcgenreforms")},"http://id.loc.gov/resources/works":{name:"LC-Works",load:e("src/lookups/lcworks")},"http://id.loc.gov/resources/instances":{name:"LC-Instances",load:e("src/lookups/lcinstances")},"http://id.loc.gov/vocabulary/organizations":{name:"Organizations",load:e("src/lookups/lcorganizations")},"http://id.loc.gov/vocabulary/relators":{name:"Relators",load:e("src/lookups/relators")},"http://rdaregistry.info/termList/FormatNoteMus":{name:"RDA-Format-Musical-Notation",load:e("src/lookups/rdaformatnotemus")},"http://rdaregistry.info/termList/RDAMediaType":{name:"RDA-Media-Type",load:e("src/lookups/rdamediatype")},"http://rdaregistry.info/termList/ModeIssue":{name:"RDA-Mode-Issue",load:e("src/lookups/rdamodeissue")},"http://rdaregistry.info/termList/RDACarrierType":{name:"RDA-Carrier-Type",load:e("src/lookups/rdacarriertype")},"http://rdaregistry.info/termList/RDAContentType":{name:"RDA-Content-Type",load:e("src/lookups/rdacontenttype")},"http://rdaregistry.info/termList/frequency":{name:"RDA-Frequency",load:e("src/lookups/rdafrequency")},"http://www.rdaregistry.info/termList/AspectRatio":{name:"RDA-Aspect-Ratio",load:e("src/lookups/rdaaspectration")},"http://www.rdaregistry.info/termList/RDAGeneration":{name:"RDA-Generation",load:e("src/lookups/rdageneration")}};function v(e){$("#bfeditor-loader").width($("#bfeditor-loader").width()+5+"%"),g++;var t=bfeditor.bfestore.loadtemplates;if(g>=b&&($("#bfeditor-formdiv").html(""),t.length>0)){n.addMsg(new Error,"DEBUG","Loading selected template(s)",t);var o=y(t,e);$(".typeahead",o.form).each(function(){j(this)});var r=$('<div class="btn-group pull-right">                       <button id="bfeditor-cancel" type="button" class="btn btn-default">Cancel</button>                       <button id="bfeditor-preview" type="button" class="btn btn-primary">Preview</button>                   </div>');o.form.append(r),$("<input>",{type:"hidden",id:"profile-id",value:t[0].resourceTemplateID}).appendTo(o.form),$("#bfeditor-cancel",o.form).click(function(){$("#bfeditor-formdiv").empty(),$("[href=#browse]").tab("show"),bfeditor.bfestore.store=[],window.location.hash="",$("#table_id").DataTable().search("").draw(),$("#table_id").DataTable().ajax.reload()}),$("#bfeditor-cancel",o.form).attr("tabindex",f++),$("#bfeditor-preview",o.form).click(function(){var e=bfeditor.bfestore.store2text(),o=bfeditor.bfestore.store2jsonldExpanded();function r(e){$("#humanized .panel-body pre").text(e)}bfeditor.bfestore.store2jsonldcompacted(o,function(e){bfeditor.bfestore.store2turtle(e,r),$("#jsonld .panel-body pre").text(JSON.stringify(e,void 0," ")),bfeditor.bfestore.store2jsonldnormalized(e,function(e){d3.jsonldVis(e,"#jsonld-vis .panel-body",{w:800,h:600,maxLabelWidth:250})})}),document.body.scrollTop=document.documentElement.scrollTop=0;var s,d=$('<div class="btn-group" id="save-btn">                            <button id="bfeditor-exitback" type="button" class="btn btn-default">&#9664;</button>                            <button id="bfeditor-exitcancel" type="button" class="btn btn-default">Cancel</button>                            <button id="bfeditor-exitsave" type="button" class="btn btn-primary">Save</button>                            <button id="bfeditor-exitpublish" type="button" class="btn btn-danger">Post</button>                            </div>'),l=$("#create > .row"),p=$('<div id="bfeditor-previewPanel" class="col-md-10 main panel-group">                           <div class="panel panel-default"><div class="panel-heading">                           <h3 class="panel-title"><a role="button" data-toggle="collapse" href="#humanized">Preview</a></h3></div>                           <div class="panel-collapse collapse in" id="humanized"><div class="panel-body"><pre>'+e+'</pre></div></div>                           <div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title"><a role="button" data-toggle="collapse" href="#jsonld">JSONLD</a></h3></div>                           <div class="panel-collapse collapse in" id="jsonld"><div class="panel-body"><pre>'+JSON.stringify(o,void 0," ")+'</pre></div></div>                           <div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title"><a role="button" data-toggle="collapse" href="#rdfxml">RDF-XML</a></h3></div>                           <div class="panel-collapse collapse in" id="rdfxml"><div class="panel-body"><pre></pre></div></div>                           <div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title"><a role="button" data-toggle="collapse" href="#jsonld-vis">Visualize</a></h3</div></div>                           <div class="panel-collapse collapse in" id="jsonld-vis"><div class="panel-body"></div></div></div>                           </div>');l.append(d),$("#bfeditor-exitback").click(function(){$("#save-btn").remove(),$("#bfeditor-previewPanel").remove(),$("#bfeditor-messagediv").remove(),$("#bfeditor-formdiv").show()}),$("#bfeditor-exitcancel, [href=#browse]").click(function(){$("#save-btn").remove(),$("#bfeditor-previewPanel").remove(),$("#bfeditor-messagediv").remove(),$("#bfeditor-formdiv").show(),$("#bfeditor-formdiv").empty(),$("[href=#browse]").tab("show"),window.location.hash="",bfeditor.bfestore.store=[],$("#table_id").DataTable().ajax.reload()}),$("#bfeditor-exitsave").click(function(){if(void 0!==a.save.callback){var e={};if(e.name=bfeditor.bfestore.name,e.profile=t[0].resourceTemplateID,e.url=config.url+"/verso/api/bfs?filter=%7B%22where%22%3A%20%7B%22name%22%3A%20%22"+bfeditor.bfestore.name+"%22%7D%7D",e.created=bfeditor.bfestore.created,e.modified=(new Date).toUTCString(),_.some(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/adminMetadata"})){var o=new Date(e.modified).toJSON().split(/\./)[0];if(_.some(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/changeDate"}))_.each(_.where(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/changeDate"}),function(e){e.o=o});else{var r={};r.s=_.find(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/adminMetadata"}).o,r.p="http://id.loc.gov/ontologies/bibframe/changeDate",r.o=o,r.otype="literal",bfeditor.bfestore.store.push(r)}}e.rdf=bfeditor.bfestore.store2jsonldExpanded(),e.addedproperties=u,_.some(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/mainTitle"})?a.save.callback(e,a.getCSRF.callback(),n,function(e,t){console.log("Saved: "+t)}):((s=$("<div>",{id:"bfeditor-messagediv",class:"alert alert-danger",role:"alert"})).append("<strong>No title found:</strong><a href="+bfeditor.bfestore.url+">"+N(bfeditor.bfestore.name)+"</a>"),s.insertBefore(".tabs"))}else $("#bfeditor-formdiv").empty(),$("[href=#browse]").tab("show"),bfeditor.bfestore.store=[],$("#table_id").DataTable().ajax.reload(),s.append('<span class="str"><h3>Save disabled</h3></span>'),$("#bfeditor-formdiv").append(s)}),$("#bfeditor-exitpublish").click(function(){if(_.some(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/instanceOf"}))_.find(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/instanceOf"}).o;if(void 0!==a.publish.callback)if(_.some(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/mainTitle"})){var e=$("#rdfxml .panel-body pre").text(),o={};if(o.name=N(bfeditor.bfestore.name),o.profile=t[0].resourceTemplateID,o.url=bfeditor.bfestore.url,o.created=bfeditor.bfestore.created,o.modified=(new Date).toUTCString(),_.some(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/adminMetadata"})){var r=new Date(o.modified).toJSON().split(/\./)[0];if(_.some(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/changeDate"}))_.each(_.where(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/changeDate"}),function(e){e.o=r});else{var d={};d.s=_.find(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/adminMetadata"}).o,d.p="http://id.loc.gov/ontologies/bibframe/changeDate",d.o=r,d.otype="literal",bfeditor.bfestore.store.push(d)}}o.status="published",o.objid="loc.natlib.instances."+o.name+"0001";var l=_.where(_.where(bfeditor.bfestore.store,{s:_.where(bfeditor.bfestore.store,{o:"http://id.loc.gov/ontologies/bibframe/Lccn"})[0].s}),{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#value"});if(!_.isEmpty(l))for(i=0;i<l.length;i++)l[i].o.trim().startsWith("n")||(o.lccn=l[i].o.trim(),o.objid="loc.natlib.instances.e"+o.lccn+"0001");o.rdf=bfeditor.bfestore.store2jsonldExpanded(),a.publish.callback(o,e,bfeditor.bfestore.name,n,function(e,t){console.log("Publish:"+e+" "+t)})}else(s=$("<div>",{id:"bfeditor-messagediv",class:"col-md-10 main"})).append('<div class="alert alert-error"><strong>No title found:</strong><a href='+bfeditor.bfestore.url+">"+N(bfeditor.bfestore.name)+"</a></div>"),s.insertBefore(".tabs");else $("#bfeditor-formdiv").empty(),$("[href=#browse]").tab("show"),bfeditor.bfestore.store=[],$("#table_id").DataTable().ajax.reload(),s.append('<span class="str"><h3>Publishing disabled</h3></span>'),$("#bfeditor-formdiv").append(s)}),$("#bfeditor-formdiv").hide(),l.append(p)}),$("#bfeditor-exitpreview",o.form).attr("tabindex",f++),$("#bfeditor-formdiv").html(""),$("#bfeditor-formdiv").append(o.form),$("#bfeditor-debug").html(JSON.stringify(bfeditor.bfestore.store,void 0," ")),$("#bfeditor-debug").html(JSON.stringify(n.getLog(),void 0," ")),bfeditor.bfestore.state="edit"}}function w(e){var t=e.replace("sp-","").split("_"),o=a.startingPoints[t[0]].menuItems[t[1]];u=[],bfeditor.bfestore.store=[],bfeditor.bfestore.name=S(),bfeditor.bfestore.created=(new Date).toUTCString(),bfeditor.bfestore.url=config.url+"/verso/api/bfs?filter=%7B%22name%22%3A%20%22"+bfeditor.bfestore.name+"%22%7D",bfeditor.bfestore.state="create",loadtemplatesCounter=0,loadtemplatesCount=o.useResourceTemplates.length;var r=[];o.useResourceTemplates.forEach(function(e){var t=S(),o={};o.templateGUID=t,o.resourceTemplateID=e,o.embedType="page",o.data=[],r.push(o)}),bfeditor.bfestore.loadtemplates=r,v()}function y(e,t){var o,r=S(),i={};i.id=r,i.store=[],i.resourceTemplates=[],i.resourceTemplateIDs=[],i.formTemplates=[];for(var l=0;l<e.length;l++)void 0!==(o=_.where(p,{id:e[l].resourceTemplateID}))&&void 0!==o[0]?(i.resourceTemplates[l]=JSON.parse(JSON.stringify(o[0])),i.resourceTemplates[l].data=e[l].data,i.resourceTemplates[l].defaulturi=e[l].resourceURI,i.resourceTemplates[l].useguid=e[l].templateGUID,i.resourceTemplates[l].embedType=e[l].embedType,void 0===i.resourceTemplates[l].defaulturi&&O(i.resourceTemplates[l],a.baseURI,function(t){var o=_.filter(bfeditor.bfestore.store,function(e){return-1!==e.s.indexOf(t)});if(_.isEmpty(o))i.resourceTemplates[l].defaulturi=t+N(e[l].templateGUID);else{var r=_.where(o,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:i.resourceTemplates[l].resourceURI});if(_.isEmpty(r)){var a=i.resourceTemplates[l],d={};d.guid=a.useguid,d.rtID=a.id,d.s=o[0].s,d.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",d.o=a.resourceURI,d.otype="uri",s.addTriple(d),i.resourceTemplates[l].defaulturi=d.s}else i.resourceTemplates[l].defaulturi=r[0].s}}),i.resourceTemplateIDs[l]=o[0].id):n.addMsg(new Error,"WARN","Unable to locate resourceTemplate. Verify the resourceTemplate ID is correct.");var b=$("<form>",{id:"bfeditor-form-"+i.id,class:"form-horizontal",role:"form"}),g=!0;return t&&(i.resourceTemplates[0].propertyTemplates=t),i.resourceTemplates.forEach(function(e){n.addMsg(new Error,"DEBUG","Creating form for: "+e.id,e);var o=$("<div>",{id:e.useguid,"data-uri":e.defaulturi}),r=$("<h4>"+e.resourceLabel+" </h4>");if(e.defaulturi.match(/^http/)){var a=e.defaulturi,s=$('<a><span class="glyphicon glyphicon-info-sign"></span></a>');s.attr("data-content",a),s.attr("data-toggle","popover"),s.attr("title","Resource ID"),s.attr("id","resource-id-popover"),s.popover({trigger:"click hover"}),r.append(s)}var d=$('<button type="button" class="pull-right btn btn-primary" data-toggle="modal" data-target="#clone-input"><span class="glyphicon glyphicon-duplicate"></span></button>');if(e.id.match(/:Instance$/i)?(d.attr("id","clone-instance"),d.text(" Clone Instance"),d.data({match:"instances",label:"Instance"})):e.id.match(/:Work$/i)&&(d.attr("id","clone-work"),d.text(" Clone Work"),d.data({match:"works",label:"Work"})),d.attr("id")&&"modal"!=e.embedType){var l=N(S());r.append(d),$cloneinput=$('            <div id="clone-input" class="modal" tabindex="-1" role="dialog">              <div class="modal-dialog" role="document">                <div class="modal-content">                  <div class="modal-header">                    <h4 class="modal-title">Clone '+d.data("label")+'</h4>                    \x3c!-- <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button> --\x3e                  </div>                  <div class="modal-body">                      <div class="input-group col-xs-12">                        <span class="input-group-addon">New Resource ID:</span>                        <input type="text" class="form-control" id="resource-id" value="'+l+'">                        <span class="input-group-btn">                          <button class="btn btn-default" type="button" id="clear-id">Clear</button>                        </span>                      </div>                  </div>                  <div class="modal-footer">                    <button type="button" class="btn btn-primary" id="clone-save">Save</button>                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>                  </div>                </div>              </div>            </div>'),o.append($cloneinput)}o.append(r),o.find("#clear-id").click(function(){$("#resource-id").attr("value",""),$("#resource-id").focus()}),o.find("#clone-save").click(function(){var t=$("#resource-id").attr("value");$("#clone-input").modal("hide");var o=$("<div>",{id:"bfeditor-messagediv"}),r=e.defaulturi;bfeditor.bfestore.name=S();var a=d.data("label"),i=RegExp("(/"+d.data("match")+"/)[^/]+?(#.+$|$)");bfeditor.bfestore.store.forEach(function(e){e.s=e.s.replace(i,"$1"+t+"$2"),e.o=e.o.replace(i,"$1"+t+"$2")});var s=_.where(bfeditor.bfestore.store,{o:"http://id.loc.gov/ontologies/bibframe/Lccn"});void 0!==s&&s.forEach(function(e){bfeditor.bfestore.store=_.without(bfeditor.bfestore.store,_.findWhere(bfeditor.bfestore.store,{s:e.s})),bfeditor.bfestore.store=_.without(bfeditor.bfestore.store,_.findWhere(bfeditor.bfestore.store,{o:e.s}))}),_.each(_.where(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/adminMetadata"}),function(e){adminTriple={},adminTriple.s=e.o,adminTriple.p="http://id.loc.gov/ontologies/bflc/procInfo",adminTriple.o="clone "+d.data().label,adminTriple.otype="literal",bfeditor.bfestore.store.push(adminTriple)}),v();var n=0;bfeditor.bfestore.store.forEach(function(e){e.s==r&&n++}),$("#clone-work, #clone-instance").attr("disabled","disabled"),n>0?o.append('<div class="alert alert-danger">Old '+a+' URIs found in cloned description. Clone failed!<button type="button" class="close" data-dismiss="alert"><span>&times; </span></button></div>'):o.append('<div class="alert alert-info">'+a+" cloned as "+t+'<button type="button" class="close" data-dismiss="alert"><span>&times; </span></button></div>'),o.insertBefore(".nav-tabs")});var h=$("<div>",{class:"form-group row"}),m=$('<div class="form-group row"><div class="btn-toolbar col-sm-12" role="toolbar"></div></div></div>'),w=$('<div class="col-sm-6"><input type="text" class="form-control" id="'+e.useguid+'" placeholder="'+e.defaulturi+'" tabindex="'+f+++'"></div>'),y=$('<div class="btn-group btn-group-md span1"><button type="button" class="btn btn-default" tabindex="'+f+++'">&#10133;</button></div>'),T=$('<button type="button" class="btn btn-default" tabindex="'+f+++'">&#x1f517;</button></div>'),x=$('<div class="modal fade" id="linkmodal'+e.useguid+'" role="dialog"><div class="modal-dialog"><div class="modal-content">         <div class="modal-header"><button type="button" class="close" data-dismiss="modal">x</button><h4 class="modal-title">Link</h4></div>         <div class="modal-body">'+e.defaulturi+"</div></div></div></div>");y.click(function(){I(i.id,e.useguid,e.useguid+" input",e)}),T.click(function(){$("#bfeditor").append(x),$("#linkmodal"+e.useguid).modal(),$("#linkmodal"+e.useguid).on("show.bs.modal",function(e){$(this).css("z-index",1e4)})});w.keyup(function(t){13==t.keyCode&&(I(i.id,e.useguid,(void 0).guid),$("#"+(void 0).guid).parent().parent().next().find("input:not('.tt-hint')").length?$("#"+(void 0).guid).parent().parent().next().find("input:not('.tt-hint')").focus():$("[id^=bfeditor-modalSave]").focus())}),w.append(m),o.append(h);var E,j={};if(void 0===u||"page"!=e.embedType||t||u.forEach(function(t){e.propertyTemplates.push(t)}),e.propertyTemplates.forEach(function(t){var r=S();t.guid=r,t.display="true",j[t.propertyURI]=1;var a,s,d=$("<div>",{class:"form-group row"}),n=$('<div class="form-group row"><div class="btn-toolbar col-sm-12" role="toolbar"></div></div></div>'),l=$('<label for="'+t.guid+'" class="col-sm-3 control-label" title="'+t.remark+'">'+t.propertyLabel+"</label>");if(/^http/.test(t.remark)&&(l=$('<label for="'+t.guid+'" class="col-sm-3 control-label" title="'+t.remark+'"><a href="'+t.remark+'" target="_blank">'+t.propertyLabel+"</a></label>")),"literal"==t.type){var c=void 0!==t.valueConstraint.validatePattern?' pattern="'+t.valueConstraint.validatePattern+'"':"";(a=$('<div class="col-sm-8"><input type="text" class="form-control" id="'+t.guid+'" placeholder="'+t.propertyLabel+'"'+c+'" tabindex="'+f+++'"></div>')).find("input").keyup(function(e){if(54==e.keyCode&&e.ctrlKey&&e.altKey){var t=this.value;this.value=t+"©"}else 53==e.keyCode&&e.ctrlKey&&e.altKey&&(this.value=this.value+"℗")}),(s=$('<div class="btn-group btn-group-md span1"><button type="button" class="btn btn-default" tabindex="'+f+++'">&#10133;</button></div>')).click(function(){1==a.find(":invalid").length?alert("Invalid Value!\nThe value should match: "+t.valueConstraint.validatePattern):k(i.id,e.useguid,t.guid)});a.keyup(function(o){13==o.keyCode&&(k(i.id,e.useguid,t.guid),$("#"+t.guid).parent().parent().next().find("input:not('.tt-hint')").length?$("#"+t.guid).parent().parent().next().find("input:not('.tt-hint')").focus():$("[id^=bfeditor-modalSave]").focus())}),d.append(l),a.append(n),d.append(a),d.append(s)}if("resource"===t.type||"lookup"===t.type||"target"===t.type)if(_.has(t,"valueConstraint"))if(_.has(t.valueConstraint,"valueTemplateRefs")&&!_.isEmpty(t.valueConstraint.valueTemplateRefs)){for(var u=$('<div class="col-sm-8" id="'+t.guid+'"></div>'),b=$('<div class="btn-group btn-group-md"></div>'),h=t.valueConstraint.valueTemplateRefs,m=0;m<h.length;m++){var v=h[m],w=_.where(p,{id:v});if(void 0!==w[0]){var y=w[0],T=$('<button type="button" class="btn btn-default" tabindex="'+f+++'">'+y.resourceLabel+"</button>"),x=i.id,E=(e.useguid,t.guid),I="_:bnode"+L(S());T.click({fobjectid:x,newResourceURI:I,propertyguid:E,template:y},function(e){var t="_:bnode"+L(S());R(e.data.fobjectid,e.data.template,t,e.data.propertyguid,[])}),b.append(T)}}u.append(b),d.append(l),u.append(n),d.append(u)}else if(_.has(t.valueConstraint,"useValuesFrom")){if("modal"!=e.embedType&&g&&t.propertyLabel.match(/lookup/i))return void(g=!1);var U=$('<div class="col-sm-8"></div>');a=$('<input type="text" class="typeahead form-control" data-propertyguid="'+t.guid+'" id="'+t.guid+'" placeholder="'+t.propertyLabel+'" tabindex="'+f+++'">');var C=$('<input type="hidden" id="'+t.guid+'_page" class="typeaheadpage" value="1">');if(U.append(a),U.append(C),a.on("focus",function(){""===$(this).val()&&$(this).data().ttTypeahead.input.trigger("queryChanged","")}),d.append(l),U.append(n),d.append(U),"modal"==e.embedType&&g&&t.propertyLabel.match(/lookup/i)){var N=$('<div class="modal-header" style="text-align: right;"><button type="button" class="btn btn-primary" id="bfeditor-modalSaveLookup-'+i.id+'" tabindex="'+f+++'">Save changes</button></div>'),O=$('<div class="modal-header" style="text-align: center;"><h2>OR</h2></div>');d.append(N),d.append(O)}}else a=$('<div class="col-sm-8"><input class="form-control" id="'+t.guid+'" placeholder="'+t.propertyLabel+'" tabindex="'+f+++'"></div>'),(s=$('<div class="col-sm-1"><button type="button" class="btn btn-default" tabindex="'+f+++'">Set</button></div>')).click(function(){D(i.id,e.useguid,t.guid)}),d.append(l),a.append(n),d.append(a),d.append(s);else a=$('<div class="col-sm-8"><input class="form-control" id="'+t.guid+'" placeholder="'+t.propertyLabel+'" tabindex="'+f+++'"></div>'),(s=$('<div class="col-sm-1"><button type="button" class="btn btn-default" tabindex="'+f+++'">Set</button></div>')).click(function(){D(i.id,e.useguid,t.guid)}),d.append(l),a.append(n),d.append(a),d.append(s);o.append(d),g=!1}),"page"==e.embedType){$addpropdata=$("<div>",{class:"col-sm-8"}),$addpropinput=$("<input>",{id:"addproperty",type:"text",class:"form-control",placeholder:"Type for suggestions"}),$addpropinput.appendTo($addpropdata).typeahead({highlight:!0},{name:"resources",displayKey:"value",source:(E=c,function(e,t){var o,r;o=[],r=new RegExp(e,"i"),$.each(E,function(e,t){r.test(t.propertyLabel)&&!j[t.propertyURI]&&o.push({value:e})}),t(o)})}).on("typeahead:selected",function(t,o){var r=c[o.value];console.log(r),r.display="true",r.guid=S(),e.propertyTemplates.push(r),u.push(r),v(e.propertyTemplates)}),$addproplabel=$('<label class="col-sm-3 control-label">Add Property</label>'),$addprop=$("<div>",{class:"form-group row"}),$addprop.append($addproplabel),$addprop.append($addpropdata),o.append($addprop)}b.append(o)}),i.resourceTemplates.forEach(function(e){_.where(s.store,{o:e.resourceURI}).length>0&&("edit"!==s.state?_.where(s.store,{o:e.resourceURI}).forEach(function(t){0===_.where(s.store,{o:t.s}).length&&(console.log(t.s),e.defaulturi=t.s)}):_.where(s.store,{s:e.defaulturi,o:e.resourceURI}).forEach(function(t){0===_.where(s.store,{o:t.s}).length&&(console.log(t.s),e.defaulturi=t.s)}));var t={};if("create"!==s.state&&0===e.data.length&&0===_.where(s.store,{s:e.defaulturi,o:e.resourceURI}).length){S();void 0!==e.defaulturi&&""!==e.defaulturi?i.defaulturi=e.defaulturi:i.defaulturi=a.baseURI+e.useguid,"edit"===s.state&&_.some(s.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:e.resourceURI})?(t=_.find(s.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:e.resourceURI}),e.defaulturi=t.o,e.guid=t.guid,t.rtID=e.id):((t={}).guid=e.useguid,t.rtID=e.id,t.s=i.defaulturi,t.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",t.o=e.resourceURI,t.otype="uri",i.store.push(t),s.addTriple(t),e.guid=e.useguid),e.propertyTemplates.forEach(function(o){if(_.has(o,"valueConstraint")&&_.has(o.valueConstraint,"valueTemplateRefs")&&!_.isEmpty(o.valueConstraint.valueTemplateRefs))for(var r=o.valueConstraint.valueTemplateRefs,a=0;a<r.length;a++){var d=r[a];if(i.resourceTemplateIDs.indexOf(d)>-1&&d!=e.id){var n=_.where(s.store,{rtID:d});(t={}).guid=S(),t.s=uri,t.p=o.propertyURI,t.o=n[0].s,t.otype="uri",i.store.push(t),console.log("3"),s.addTriple(t),o.display="false"}}})}else i.defaulturi=e.defaulturi,"create"===s.state&&((t={}).guid=e.useguid,t.rtID=e.id,t.s=e.defaulturi,t.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",t.o=e.resourceURI,t.otype="uri",i.store.push(t),console.log("4"),s.addTriple(t),e.guid=e.useguid),e.data.forEach(function(e){var t={};void 0===(t=e).guid&&(t.guid=S()),i.store.push(t)});n.addMsg(new Error,"DEBUG","Populating form with pre-loaded data, if any"),e.propertyTemplates.forEach(function(t){!function(e,t,o,r){var i=_.where(s.store,{s:t.defaulturi,p:e.propertyURI});i.length;if(i.length>0&&void 0!==e.valueConstraint.valueTemplateRefs[0]){var l=_.find(bfeditor.profiles,function(t){for(var o=0;o<e.valueConstraint.valueTemplateRefs.length;o++)if(_.some(t.Profile.resourceTemplates,{id:e.valueConstraint.valueTemplateRefs[o]}))return t});if(void 0!==l){for(var p=[],c=0;c<e.valueConstraint.valueTemplateRefs.length;c++)if(_.some(l.Profile.resourceTemplates,{id:e.valueConstraint.valueTemplateRefs[c]})){var u=_.find(l.Profile.resourceTemplates,{id:e.valueConstraint.valueTemplateRefs[c]}).resourceURI;_.some(s.store,{o:u})&&p.push(_.find(s.store,{o:u}))}var f=[];if(_.isEmpty(p))if("loaduri"===s.state&&i[0].o.startsWith("http://id.loc.gov/resources/works")){var b={};b.s=i[0].s,b.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",b.o="http://id.loc.gov/ontologies/bibframe/Work",b.otype="uri",b.guid=S(),s.addTriple(b),(f=[]).push(b),i=f}else i=[];else{for(var g=0;g<p.length;g++){bnodes=_.where(s.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:p[g].o});for(var h=0;h<i.length;h++)_.some(bnodes,{s:i[h].o})&&f.push(i[h])}i=f}}}i[0];if(void 0!==i[0])n.addMsg(new Error,"DEBUG","Found pre-loaded data for "+e.propertyURI),r.resourceTemplates[0].defaulturi.startsWith("_:bnode")?_.some(i,{s:r.resourceTemplates[0].defaulturi})?i.forEach(function(t){T(t,e,o,r)}):console.log("bnode not matched"):i.forEach(function(t){T(t,e,o,r)});else if(_.has(e,"valueConstraint")){if(!_.has(e.valueConstraint,"defaults")){e.valueConstraint.defaults=[];var m={};_.isEmpty(e.valueConstraint.defaultURI)||(m.defaultURI=e.valueConstraint.defaultURI),_.isEmpty(e.valueConstraint.defaultLiteral)||(m.defaultLiteral=e.valueConstraint.defaultLiteral),_.isEmpty(m)||e.valueConstraint.defaults.push(m)}for(d=0;d<e.valueConstraint.defaults.length;d++)if(!_.isEmpty(e.valueConstraint.defaults[d].defaultURI)||!_.isEmpty(e.valueConstraint.defaults[d].defaultLiteral)){var v,w;if("literal"===e.type){var y={};y.guid=S(),void 0!==t.defaulturi&&""!==t.defaulturi?y.s=t.defaulturi:y.s=a.baseURI+t.useguid,y.p=e.propertyURI,y.o=e.valueConstraint.defaults[d].defaultLiteral,y.otype="literal",w=y,displayguid=y.guid,r.store.push(y),s.addTriple(y)}else if(_.has(e.valueConstraint.defaults[d],"defaultURI")&&!_.isEmpty(e.valueConstraint.defaults[d].defaultURI)){if(v=e.valueConstraint.defaults[d].defaultURI,n.addMsg(new Error,"DEBUG","Setting default data for "+e.propertyURI),_.has(e.valueConstraint.valueDataType,"dataTypeURI")){var R={};R.guid=S(),R.s=v,R.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",R.o=e.valueConstraint.valueDataType.dataTypeURI,R.otype="uri",r.store.push(R),s.addTriple(R)}var b={};b.guid=S(),void 0!==t.defaulturi&&""!==t.defaulturi?b.s=t.defaulturi:b.s=a.baseURI+t.useguid,b.p=e.propertyURI,b.o=v,b.otype="uri",r.store.push(b),s.addTriple(b),w={},b?(w.s=b.o,displayguid=b.guid):(w.s=t.defaulturi,displayguid=S()),w.otype="literal",w.p="http://www.w3.org/2000/01/rdf-schema#label",w.o=e.valueConstraint.defaults[d].defaultLiteral,r.store.push(w),s.addTriple(w)}var x=$("#"+e.guid,o).closest(".form-group"),I=x.find(".btn-toolbar").eq(0),k="";_.has(e.valueConstraint.defaults[d],"defaultLiteral")&&(k=e.valueConstraint.defaults[d].defaultLiteral);var D=!0;void 0!==e.valueConstraint.editable&&"false"===e.valueConstraint.editable&&(D=!1);var j={tguid:displayguid,tlabelhover:k,tlabel:k,fobjectid:r.id,inputid:e.guid,editable:D,triples:[w]},U=E(j);if(I.append(U),"false"===e.repeatable||"false"==e.valueConstraint.repeatable){var C=$("#"+e.guid,o);if(C.is("input"))C.prop("disabled",!0);else{var L=$("div.btn-group",C).find("button");L.each(function(){$(this).prop("disabled",!0)})}}}}}(t,e,b,i)})}),h.push(i),n.addMsg(new Error,"DEBUG","Newly created formobject.",i),{formobject:i,form:b}}function T(e,t,o,r){var a=$("#"+t.guid,o).closest(".form-group").find(".btn-toolbar").eq(0),i="",d=[],l=!0;if(_.find(s.store,{s:e.o,p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}))var c=_.where(p,{resourceURI:_.find(s.store,{s:e.o,p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}).o});if(void 0!==c&&!_.isEmpty(c)&&"edit"!==s.state){var u=!1;t.valueConstraint.valueTemplateRefs.forEach(function(e){_.some(c,{id:e})&&(console.log(t.propertyLabel+" accepts "+e),u=!0)}),u||(console.log(t.propertyLabel+" did not match"+e.o),l=!1)}if("uri"==e.otype&&l){var f="";(d=_.where(s.store,{s:e.o})).length>0&&d.forEach(function(o){""===f&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===o.p&&(f=o.o,o.s);var a="";""!==f&&(_.has(t,"valueConstraint")&&_.has(t.valueConstraint,"valueTemplateRefs")&&!_.isEmpty(t.valueConstraint.valueTemplateRefs)&&_.where(p,{resourceURI:f}).forEach(function(e){""===a&&-1!==_.indexOf(t.valueConstraint.valueTemplateRefs,e.id)&&(n.addMsg(new Error,"DEBUG","Assocating one resource with another from loaded templates"),a=e.id,o.rtID=e.id)}));r.store.push(o);var d=_.where(s.store,{s:e.o});if(o.p.match(/label/i))i=o.o;else if(d.length>0){var l;if("uri"===o.otype){var c=o.o;"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===o.p&&(c=o.s),c.startsWith("_:b")||q(c,function(e){l=e})}if(void 0!==l)i=l;else{var u=_.find(d,{p:"http://www.loc.gov/mads/rdf/v1#authoritativeLabel"}),b=_.find(d,{p:"http://www.w3.org/2000/01/rdf-schema#label"}),g=_.find(d,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#value"}),h=_.find(d,{p:"http://id.loc.gov/ontologies/bibframe/mainTitle"});if(void 0!==l)i=l;else if(void 0!==u)i=u.o;else if(void 0!==b)i=b.o;else if(void 0!==h)i=h.o;else if(void 0!==g)if(g.o.startsWith("http"))q(g.o,function(e){console.log(e),i=e});else{var m=_.find(d,{s:g.s,p:"http://id.loc.gov/ontologies/bibframe/qualifier"});i=_.isEmpty(m)||_.isEmpty(m.o)?g.o:g.o+" "+m.o}else{var v,w,y,$,T;if("contribution"===(i=_.last(t.propertyURI.split("/"))))w=_.find(d,{p:"http://id.loc.gov/ontologies/bibframe/role"}),v=_.find(d,{p:"http://id.loc.gov/ontologies/bibframe/agent"}),_.isEmpty(v)||(v.o.match(/#Agent/)||v.o.startsWith("_:b")?($=_.find(bfeditor.bfestore.store,{s:v.o,p:"http://www.w3.org/2000/01/rdf-schema#label"}),_.isEmpty($)||(i=$.o)):q(v.o,function(e){_.isEmpty(e)||(i=e)})),_.isEmpty(w)||q(w.o,function(e){_.isEmpty(e)||"contribution"===i||(i=i+", "+e)});else if("classification"===i)_.some(d,{p:"http://id.loc.gov/ontologies/bibframe/classificationPortion"})&&(i=_.find(d,{p:"http://id.loc.gov/ontologies/bibframe/classificationPortion"}).o);else if("provisionActivity"===i){var R=_.find(d,{p:"http://id.loc.gov/ontologies/bibframe/place"});_.isEmpty(R)||(R.o.startsWith("_:b")?y=_.find(s.store,{s:R.o,p:"http://www.w3.org/2000/01/rdf-schema#label"}).o:q(R.o,function(e){y=e})),v=_.find(d,{p:"http://id.loc.gov/ontologies/bibframe/agent"}),_.isEmpty(v)||(v.o.startsWith("_:b")?$=_.find(s.store,{s:v.o,p:"http://www.w3.org/2000/01/rdf-schema#label"}).o:q(v.o,function(e){$=e}));var x=_.find(d,{p:"http://id.loc.gov/ontologies/bibframe/date"});_.isEmpty(x)||(T=x.o),_.isEmpty(y)||_.isEmpty($)||_.isEmpty(T)?_.isEmpty(y)||_.isEmpty($)||!_.isEmpty(T)?!_.isEmpty(y)||_.isEmpty($)||_.isEmpty(T)?_.isEmpty(y)||!_.isEmpty($)||_.isEmpty(T)||(i=y+", "+T):i=$+", "+T:i=$+": "+y:i=$+": "+y+", "+T}}if(void 0===i||_.isEmpty(i)){b=_.find(_.where(s.store,{s:d[0].o}),{p:"http://www.w3.org/2000/01/rdf-schema#label"}),g=_.find(_.where(s.store,{s:d[0].o}),{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#value"}),h=_.find(_.where(s.store,{s:d[0].o}),{p:"http://id.loc.gov/ontologies/bibframe/mainTitle"});if(_.has(s.store,{s:d[0].s,p:"http://id.loc.gov/ontologies/bibframe/title"}))var E=_.find(s.store,{s:_.where(s.store,{s:d[0].s,p:"http://id.loc.gov/ontologies/bibframe/title"})[0].o,p:"http://id.loc.gov/ontologies/bibframe/mainTitle"});void 0!==b?i=b.o:void 0!==h?i=h.o:void 0!==g?i=g.o:void 0===h&&void 0===b&&void 0===g&&void 0!==E&&(i=E.o)}void 0===i&&void 0!==I&&void 0!==I.o&&(i=I.o)}}if(""===i){var I=_.where(d,{otype:"literal"});if(I.length>0)for(var k=0;k<I.length;k++)i+=I[k].o+" "}i.trim()})}else l&&(i=e.o);if(d.push(e),l){var b=E({tguid:e.guid,tlabelhover:i,tlabel:i,fobjectid:r.id,inputid:t.guid,editable:t.valueConstraint.editable,triples:d});if(a.append(b),"false"===t.repeatable||"false"==t.valueConstraint.repeatable){var g=$("#"+t.guid,o);if(g.is("input"))g.prop("disabled",!0);else $("div.btn-group",g).find("button").each(function(){$(this).prop("disabled",!0)})}}}function R(e,t,o,a,i){var s='<div class="modal fade" id="bfeditor-modal-modalID" tabindex="'+f+++'" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">               <div class="modal-dialog">                   <div class="modal-content">                       <div class="modal-header">                           <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                           <h4 class="modal-title" id="bfeditor-modaltitle-modalID">Modal title</h4>                       </div>                       <div class="modal-body" id="bfeditor-modalbody-modalID"></div>                       <div class="modal-footer">                           <button type="button" class="btn btn-default" id="bfeditor-modalCancel-modalID" data-dismiss="modal">Cancel</button>                           <button type="button" class="btn btn-primary" id="bfeditor-modalSave-modalID">Save changes</button>                       </div>                   </div>               </div>           </div> ';n.addMsg(new Error,"DEBUG","Opening modal for resourceURI "+o),n.addMsg(new Error,"DEBUG","inputID of DOM element / property when opening modal: "+a),n.addMsg(new Error,"DEBUG","callingformobjectid when opening modal: "+e);var d=S(),l=[];if(0===i.length){var p=_.where(h,{id:e});(p=p[0]).resourceTemplates.forEach(function(e){var r=_.where(e.propertyTemplates,{guid:a});if(void 0!==r[0]){var i={};if(i.s=e.defaulturi,i.p=r[0].propertyURI,i.o=o,i.otype="uri",l.push(i),(i={}).s=o,i.rtID=t.id,i.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",i.o=t.resourceURI,i.otype="uri",l.push(i),"http://id.loc.gov/ontologies/bibframe/adminMetadata"===r[0].propertyURI){var s="e"+window.ShortUUID("0123456789").fromUUID(bfeditor.bfestore.name),d=config.url+"/resources/"+s,n={};n.s=o,n.p="http://id.loc.gov/ontologies/bflc/profile",n.o=e.id,n.otype="literal",l.push(n),bfeditor.bfestore.store.push(n),(n={}).s=o,n.p="http://id.loc.gov/ontologies/bibframe/creationDate";var p=new Date(bfeditor.bfestore.created);n.o=p.getFullYear()+"-"+(p.getMonth()+1)+"-"+p.getDate(),n.otype="literal",l.push(n),bfeditor.bfestore.store.push(n),(n={}).s=o,n.p="http://id.loc.gov/ontologies/bibframe/identifiedBy",n.o=d,n.otype="uri",l.push(n),bfeditor.bfestore.store.push(n),(n={}).s=d,n.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",n.o="http://id.loc.gov/ontologies/bibframe/Local",n.otype="uri",l.push(n),bfeditor.bfestore.store.push(n),(n={}).s=d,n.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#value",n.o=s,n.otype="literal",l.push(n),bfeditor.bfestore.store.push(n)}}})}else l=i;n.addMsg(new Error,"DEBUG","triplespassed within modal",l);var c=y([{templateGUID:d,resourceTemplateID:t.id,resourceURI:o,embedType:"modal",data:l}]),u=$(s.replace(/modalID/g,c.formobject.id));$(r).append(u),$("#bfeditor-modalbody-"+c.formobject.id).append(c.form),$("#bfeditor-modaltitle-"+c.formobject.id).html(t.resourceLabel),$("#bfeditor-form-"+c.formobject.id+" > div > h3").remove(),$("#bfeditor-modal-"+c.formobject.id).modal("show"),$("#bfeditor-modalCancel-"+c.formobject.id).attr("tabindex",f++),$("#bfeditor-modalSave-"+c.formobject.id).click(function(){i.forEach(function(t){U(e,a,null,t)}),c.formobject.store.length<=2?($("#bfeditor-modalSave-"+c.formobject.id).off("click"),$("#bfeditor-modal-"+c.formobject.id).modal("hide")):x(e,c.formobject.id,o,a,c.formobject.store)}),$("#bfeditor-modalSave-"+c.formobject.id).attr("tabindex",f++),$("#bfeditor-modalSaveLookup-"+c.formobject.id).click(function(){i.forEach(function(t){U(e,a,null,t)});var t=_.find(c.formobject.store,{p:"http://www.w3.org/2000/01/rdf-schema#label"}),r=(_.find(c.formobject.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}),_.find(c.formobject.store,{o:t.s}),c.formobject.store);x(e,c.formobject.id,o,a,r)}),$("#bfeditor-modal-"+c.formobject.id).on("hide.bs.modal",function(){$(this).empty()}),$(".typeahead",c.form).each(function(){j(this)}),$("#bfeditor-debug").html(JSON.stringify(bfeditor.bfestore.store,void 0," ")),$("#bfeditor-modal-"+c.formobject.id+" input:not('.tt-hint'):first").focus()}function x(e,t,o,r,a){n.addMsg(new Error,"DEBUG","Setting resource from modal"),n.addMsg(new Error,"DEBUG","modal form id is: "+t);var i=_.where(h,{id:e});i=i[0];var d=_.find(_.find(h,{id:t}).resourceTemplates,{defaulturi:o}).resourceURI,l={guid:S(),s:o,otype:"uri",p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:d};a.push(l),i.resourceTemplates.forEach(function(t){var o=_.where(t.propertyTemplates,{guid:r});if(void 0!==o[0]){n.addMsg(new Error,"DEBUG","Data from modal: ",a);var d=$("#"+r,i.form).closest(".form-group").find(".btn-toolbar")[0];n.addMsg(new Error,"DEBUG","Selected property from calling form: "+o[0].propertyURI);_.find(a,function(e){return e.p.match(/rdf-schema#label/i)?e:e.p.match(/rdf-syntax-ns#value/i)?e:void 0});var l=_.find(a,{p:"http://www.loc.gov/mads/rdf/v1#authoritativeLabel"}),p=_.find(a,{p:"http://www.w3.org/2000/01/rdf-schema#label"}),c=_.find(a,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#value"}),u=/[^/]*$/.exec(_.find(a,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}).o)[0],f="";if(void 0!==l)f=l.o,u=l.s;else if(void 0!==p)f=p.o,u=p.s;else if(void 0!==c)f=c.o,u=c.s;else{for(var b in a)"literal"!==a[b].otype||/^\d/.test(a[b].o)||(f+=a[b].o+" ",u=a[b].s);if(void 0===f||""===f){f=u;var g={guid:S(),o:u,otype:"literal",p:"http://www.w3.org/2000/01/rdf-schema#label",s:f.trim()};a.push(g)}}a.forEach(function(e){i.store.push(e),s.addTriple(e)}),s.storeDedup();var h=E({tguid:_.where(a,{p:o[0].propertyURI})[0].guid,tlabelhover:f,tlabel:f,tlabelURI:u,fobjectid:e,inputid:r,triples:a});$(d).append(h),void 0!==o[0].repeatable&&"false"==o[0].repeatable&&$("#"+r,i.form).attr("disabled",!0)}}),$("#bfeditor-modalSave-"+t).off("click"),$("#bfeditor-modal-"+t).modal("hide"),$("#bfeditor-debug").html(JSON.stringify(bfeditor.bfestore.store,void 0," "))}function E(e){var t,o=$("<div>",{id:e.tguid,class:"btn-group btn-group-xs"});t=_.isUndefined(e.tlabel)?"example":e.tlabel.length>60?e.tlabel.substr(0,58)+"...":e.tlabel;var r=$('<button type="button" class="btn btn-default" title="'+e.tlabelhover+'">'+t+"</button>");if(void 0!==e.tlabelURI&&e.tlabelURI.match("^!_:b")&&(r=$('<button type="button" class="btn btn-default" title="'+e.tlabelhover+'"><a href="'+e.tlabelURI+'">'+t+"</a></button>")),o.append(r),void 0===e.editable||!0===e.editable){var a=$('<button class="btn btn-warning" type="button"> <span class="glyphicon glyphicon-pencil"></span></button>');a.click(function(){1===e.triples.length?function(e,t,o){var r=_.where(h,{id:e});r=r[0],n.addMsg(new Error,"DEBUG","Editing triple: "+o.guid,o),$("#"+o.guid).empty();var a=$("#"+t,r.form);if(a.is("input")&&a.hasClass("typeahead")){var i=$("#"+t,r.form).parent().find("input[data-propertyguid='"+t+"']");i.each(function(){$(this).prop("disabled",!1),$(this).removeAttr("disabled"),$(this).css("background-color","transparent")})}else if(a.is("input"))a.prop("disabled",!1),a.removeAttr("disabled");else{var d=$("div.btn-group",a).find("button");d.each(function(){$(this).prop("disabled",!1)})}a.is("input")&&"literal"==o.otype&&a.val(o.o);r.store=_.without(r.store,_.findWhere(r.store,{guid:o.guid})),s.store=_.without(s.store,_.findWhere(s.store,{guid:o.guid})),$("#bfeditor-debug").html(JSON.stringify(s.store,void 0," "))}(e.fobjectid,e.inputid,e.triples[0]):function(e,t,o,r){n.addMsg(new Error,"DEBUG","Editing triples",r);var a=_.where(r,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"});void 0==a[0]&&(a=_.where(r,{p:"@type"}));if(n.addMsg(new Error,"DEBUG","Triples represent these resourceTypes",a),void 0!==a[0]&&void 0!==typeof a[0]&&void 0!==a[0].rtID){var i=_.where(h,{id:e});i=i[0];var s=_.where(p,{id:a[0].rtID});void 0!==s[0]&&(n.addMsg(new Error,"DEBUG","Opening modal for editing",r),R(i.id,s[0],a[0].s,t,r))}else C(e,t,o,r)}(e.fobjectid,e.inputid,e.tguid,e.triples)}),o.append(a)}var i=$('<button class="btn btn-danger" type="button"><span class="glyphicon glyphicon-trash"></span> </button>');return i.click(function(){1===e.triples.length?U(e.fobjectid,e.inputid,e.tguid,e.triples[0]):C(e.fobjectid,e.inputid,e.tguid,e.triples)}),o.append(i),o}function I(e,t,o,r){var a=_.where(h,{id:e});a=a[0];var i=$("#"+o).val();if(void 0!==i&&""!==i){var d={};d.guid=S(),d.s=r.defaulturi,d.p="http://www.w3.org/2000/01/rdf-schema#label",d.o=i,d.otype="literal",d.olang="en",s.addTriple(d),a.store.push(d);var n=$("#"+o,a.form).closest(".form-group"),l=$(n).find(".btn-toolbar")[0],p=E({tguid:d.guid,tlabel:i,tlabelhover:i,fobjectid:e,inputid:o,triples:[d]});$(l).append(p),$("#"+o).val("")}$("#bfeditor-debug").html(JSON.stringify(s.store,void 0," "))}function k(e,t,o){var r=_.where(h,{id:e});r=r[0];var a=$("#"+o,r.form).val();if(void 0!==a&&""!==a){var i={};i.guid=S(),r.resourceTemplates.forEach(function(t){var d=_.where(t.propertyTemplates,{guid:o});if(i.rtID=t.id,void 0!==d[0]){void 0!==t.defaulturi&&""!==t.defaulturi?i.s=t.defaulturi:i.s=t.resouceURI,i.p=d[0].propertyURI,i.o=a,i.otype="literal",s.addTriple(i),r.store.push(i);var n=$("#"+o,r.form).closest(".form-group"),l=$(n).find(".btn-toolbar")[0],p=E({tguid:i.guid,tlabel:a,tlabelhover:a,fobjectid:e,inputid:o,triples:[i]});$(l).append(p),$("#"+o,r.form).val(""),void 0!==d[0].repeatable&&"false"==d[0].repeatable&&$("#"+o,r.form).attr("disabled",!0)}})}$("#bfeditor-debug").html(JSON.stringify(s.store,void 0," "))}function D(e,t,o){var r=_.where(h,{id:e});r=r[0];var i=$("#"+o,r.form).val();if(void 0!==i&&""!==i){var d={};d.guid=S(),r.resourceTemplates.forEach(function(n){var l=_.where(n.propertyTemplates,{guid:o});if(d.rtID=n.id,void 0!==l[0]){void 0!==n.defaulturi&&""!==n.defaulturi?d.s=n.defaulturi:d.s=a.baseURI+t,d.p=l[0].propertyURI,d.o=i,d.otype="uri",s.addTriple(d),r.store.push(d);var p=$("#"+o,r.form).closest(".form-group").find(".btn-toolbar")[0],c=E({tguid:d.guid,tlabel:d.o,tlabelhover:d.o,fobjectid:e,inputid:o,triples:[d]});$(p).append(c),$("#"+o,r.form).val(""),void 0!==l[0].repeatable&&"false"==l[0].repeatable&&$("#"+o,r.form).attr("disabled",!0)}})}$("#bfeditor-debug").html(JSON.stringify(s.store,void 0," "))}function j(t){var o=$(t).closest("form").eq(0).attr("id"),r=$(t).siblings(".typeaheadpage").attr("id");o=o.replace("bfeditor-form-","");var i=_.where(h,{id:o});i=i[0],void 0!==r&&(i.pageid=r);var d,l=$(t).attr("data-propertyguid");i.resourceTemplates.forEach(function(e){var t=_.where(e.propertyTemplates,{guid:l});void 0!==t[0]&&(d=t[0])});var p=[];d.valueConstraint.useValuesFrom.forEach(function(t){var o=m[t];void 0===o&&(o=function(t){var o=e("src/lookups/lcshared"),r=[],a={};a.name=t.substr(t.lastIndexOf("/")+1);var i=t;return a.load={scheme:i,source:function(e,t){return o.simpleQuery(e,r,i,t)},getResource:function(e,t,r,a){return o.getResource(e,t,r,a)}},a}(t),m[t]=o),n.addMsg(new Error,"DEBUG","Setting typeahead scheme: "+t),n.addMsg(new Error,"DEBUG","Lookup is",o);var r={};r.name=o.name,r.source=function(e,t){o.load.source(e,t,i)},r.templates={header:"<h3>"+o.name+"</h3>",footer:'<div id="dropdown-footer" class=".col-sm-1"></div>'},r.displayKey="display",p.push(r)}),n.addMsg(new Error,"DEBUG","Data source hashes",p);var c={minLength:0,highlight:!0,displayKey:"value"};1===p.length?$(t).typeahead(c,p[0]):2===p.length?$(t).typeahead(c,p[0],p[1]):3===p.length?$(t).typeahead(c,p[0],p[1],p[2]):4===p.length?$(t).typeahead(c,p[0],p[1],p[2],p[3]):5===p.length?$(t).typeahead(c,p[0],p[1],p[2],p[3],p[4]):6===p.length&&$(t).typeahead(c,p[0],p[1],p[2],p[3],p[4],p[5]),$(t).on("typeahead:selected",function(e,o,r){n.addMsg(new Error,"DEBUG","Typeahead selection made");var i=$("#"+e.target.id).closest("form").eq(0),d=$("#"+e.target.id).closest("form").eq(0).attr("id");d=d.replace("bfeditor-form-",""),$(t).parent().siblings(".typeaheadpage").val(1);var l=$(i).children("div").eq(0).attr("id"),p=$(i).find("div[data-uri]").eq(0).attr("data-uri"),c=$("#"+e.target.id).attr("data-propertyguid");n.addMsg(new Error,"DEBUG","propertyguid for typeahead input is "+c);a.baseURI;var u="",f=_.where(h,{id:d});(f=f[0]).resourceTemplates.forEach(function(e){var t=_.where(e.propertyTemplates,{guid:c});void 0!==t[0]&&(u=t[0])});var b,g=_.where(m,{name:r});void 0!==g[0]&&(n.addMsg(new Error,"DEBUG","Found lookup for datasetname: "+r,g[0]),b=g[0].load),b.getResource(p,u,o,function(e,t){n.addMsg(new Error,"DEBUG","Triples returned from lookup's getResource func:",e);var o="",r=!("Lookup"!==t.propertyLabel&&"lookup"!==t.type);e.forEach(function(e){if(void 0===e.guid){var t=S();e.guid=t}if(_.some(f.store,{s:e.s})&&"http://www.w3.org/2000/01/rdf-schema#label"!==e.p)if(o=_.find(f.store,{o:e.s}),!r||_.isEmpty(o))f.store.push(e),s.addTriple(e);else{var a=_.find(f.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:f.resourceTemplates[0].resourceURI});a.s=e.o,s.addTriple(a),r?(o.o=e.o,s.addTriple(o),f.store.push(o)):(f.store.push(e),s.addTriple(e))}else f.store.push(e),s.addTriple(e)}),e[0].s==p&&f.resourceTemplates.forEach(function(t){var o=_.where(t.propertyTemplates,{propertyURI:e[0].p});if(void 0!==o[0]){var r=o[0],a=r.guid,i=$("#"+a,f.form).closest(".form-group").find(".btn-toolbar")[0],s=_.find(e,{p:"http://www.w3.org/2000/01/rdf-schema#label"}).o,d=!0;if(void 0!==r.valueConstraint.editable&&"false"===r.valueConstraint.editable&&(d=!1),_.has(r.valueConstraint.valueDataType,"dataTypeURI")&&!_.isEmpty(r.valueConstraint.valueDataType.dataTypeURI)){var n={};n.s=_.find(e,{p:"http://www.w3.org/2000/01/rdf-schema#label"}).s,n.guid=S(),n.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",n.o=r.valueConstraint.valueDataType.dataTypeURI,n.otype="uri",f.store.push(n),bfeditor.bfestore.store.push(n)}var l=E({editable:d,tguid:S(),tlabel:s,tlabelhover:s,fobjectid:f.id,inputid:a,triples:e});if($(i).append(l),$("#"+a,f.form).val(""),$("#"+a,f.form).typeahead("val",""),$("#"+a,f.form).typeahead("close"),"false"===r.repeatable||"false"==r.valueConstraint.repeatable){var p=$("#"+a,f.form);if(p.is("input"))p.prop("disabled",!0),p.css("background-color","#EEEEEE");else $("div.btn-group",p).find("button").each(function(){$(this).prop("disabled",!0)})}}}),s.storeDedup(),$("#bfeditor-debug").html(JSON.stringify(s.store,void 0," "))})})}function U(e,t,o,r){var a=_.where(h,{id:e});a=a[0],$("#"+r.guid).length&&void 0!==r?(n.addMsg(new Error,"DEBUG","Removing triple: "+r.guid,r),$("#"+r.guid).remove()):(n.addMsg(new Error,"DEBUG","Removing triple: "+o),$("#"+o).remove(),a.store=_.without(a.store,_.findWhere(a.store,{guid:o})),s.store=_.without(s.store,_.findWhere(s.store,{guid:o})));var i=$("#"+t,a.form);if(i.is("input")&&i.hasClass("typeahead"))$("#"+t,a.form).parent().find("input[data-propertyguid='"+t+"']").each(function(){$(this).prop("disabled",!1),$(this).removeAttr("disabled"),$(this).css("background-color","transparent")});else if(i.is("input"))i.prop("disabled",!1),i.removeAttr("disabled");else{$("div.btn-group",i).find("button").each(function(){$(this).prop("disabled",!1)})}a.store=_.without(a.store,_.findWhere(a.store,{guid:r.guid})),s.store=_.without(s.store,_.findWhere(s.store,{guid:r.guid})),$("#bfeditor-debug").html(JSON.stringify(s.store,void 0," "))}function C(e,t,o,r){n.addMsg(new Error,"DEBUG","Removing triples for formobjectID: "+e+" and inputID: "+t,r),r.forEach(function(r){U(e,t,o,r)})}function S(){return window.ShortUUID().uuid()}function L(e){return window.ShortUUID().fromUUID(e)}function N(e){return"e"+window.ShortUUID("0123456789").fromUUID(e)}function O(e,t,o){if(e.resourceURI.startsWith("http://www.loc.gov/mads/rdf/v1#"))uri=e.resourceURI.replace("http://www.loc.gov/mads/rdf/v1#",config.url+"/bfe/static/v1.json#");else if(e.resourceURI.startsWith("http://id.loc.gov/resources"))uri=e.resourceURI.replace("http://id.loc.gov/resources",config.resourceURI)+".json";else{if(e.resourceURI.startsWith("http://mlvlp04.loc.gov:3000/resources"))return;uri=e.resourceURI+".json"}$.ajax({type:"GET",async:!1,data:{uri:uri},url:config.url+"/profile-edit/server/whichrt",success:function(r){var a="_:bnode",i=!1;r.some(function(o){o["@id"]!==e.resourceURI||i||(void 0!==o["http://www.w3.org/2000/01/rdf-schema#subClassOf"]?"http://id.loc.gov/ontologies/bibframe/Work"===o["http://www.w3.org/2000/01/rdf-schema#subClassOf"][0]["@id"]?(a=t+"resources/works/",i=!0):"http://id.loc.gov/ontologies/bibframe/Instance"===o["http://www.w3.org/2000/01/rdf-schema#subClassOf"][0]["@id"]?(a=t+"resources/instances/",i=!0):"http://www.loc.gov/mads/rdf/v1#Name"===o["http://www.w3.org/2000/01/rdf-schema#subClassOf"][0]["@id"]&&(a=t+"resources/agents/",i=!0):"http://id.loc.gov/ontologies/bibframe/Instance"===o["@id"]?(a=t+"resources/instances/",i=!0):"http://id.loc.gov/ontologies/bibframe/Work"===o["@id"]&&(a=t+"resources/works/",i=!0))}),o(a)},error:function(e,t,o){n.addMsg(new Error,"ERROR","Request status: "+t+"; Error msg: "+o)}})}function q(e,t){e.startsWith("http://id.loc.gov/resources")&&(e=e.replace("http://id.loc.gov/resources",config.resourceURI)),e.endsWith("marcxml.xml")?(returnval=/[^/]*$/.exec(e)[0].split(".")[0],t(returnval)):$.ajax({type:"GET",async:!1,data:{uri:e+".json"},url:config.url+"/profile-edit/server/whichrt",success:function(o){var r,a=_.where(o,"http://www.loc.gov/mads/rdf/v1#authoritativeLabel");if(void 0===a||_.isEmpty(a)){var i=_.filter(o[2],function(e){if("rdfs:label"===e[0])return e});r=_.isEmpty(i)?e:i[0][2]}else r=_.find(o,{"@id":e})["http://www.loc.gov/mads/rdf/v1#authoritativeLabel"][0]["@value"];t(r)},error:function(e,t,o){n.addMsg(new Error,"ERROR","Request status: "+t+"; Error msg: "+o)}})}t.aceconfig=e("src/lib/aceconfig"),t.require=e,t.setConfig=function(t){a=t,n.init(a);for(var o=0;o<t.profiles.length;o++){var r=t.profiles[o];$.ajax({type:"GET",dataType:"json",url:r,error:function(e,t,o){n.addMsg(new Error,"ERROR","FAILED to load profile: "+r),n.addMsg(new Error,"ERROR","Request status: "+t+"; Error msg: "+o)},complete:function(e,t){if("success"==t){var o=JSON.parse(e.responseText);if($("#bfeditor-loader").width($("#bfeditor-loader").width()+5+"%"),o.length>0)for(var r=0;r<o.length;r++){l.push(o[r].json);for(var a=0;a<o[r].json.Profile.resourceTemplates.length;a++)p.push(o[r].json.Profile.resourceTemplates[a]),o[r].json.Profile.resourceTemplates[a].propertyTemplates.forEach(function(e){if("resource"!=e.type&&void 0!==e.propertyLabel){var t=e.propertyLabel;t=t.replace(/^\d\w*\. /,""),c[t]=e}});n.addMsg(new Error,"INFO","Loaded profile: "+o[r].name)}else n.addMsg(new Error,"ERROR","No profiles loaded from "+this.url+" (empty result set)")}}})}void 0!==t.lookups&&(b+=Object.keys(t.lookups).length,t.lookups.foreach(function(t){n.addMsg(new Error,"INFO","Loading lookup: "+t.load),e([t.load],function(e){!function(e){if(void 0!==e.scheme){n.addMsg(new Error,"INFO","Setting up scheme "+e.scheme);var t=this.config.lookups[e.scheme];m[e.scheme]={},m[e.scheme].name=t.name,m[e.scheme].load=e}else n.addMsg(new Error,"WARN","Loading lookup FAILED",e)}(e)})})),void 0===a.baseURI&&(a.baseURI=window.location.protocol+"//"+window.location.host+"/"),n.addMsg(new Error,"INFO","baseURI is "+a.baseURI),void 0!==t.load&&(b+=t.load.length,t.load.forEach(function(e){var t=[];e.templateID.forEach(function(o){var r=S(),a={};a.templateGUID=r,a.resourceTemplateID=o,a.resourceURI=e.defaulturi,a.embedType="page",a.data=t,loadtemplates.push(a)}),void 0!==e.source&&void 0!==e.source.location&&void 0!==e.source.requestType?$.ajax({url:e.source.location,dataType:e.source.requestType,success:function(o){n.addMsg(new Error,"INFO","Fetched external source baseURI"+e.source.location),n.addMsg(new Error,"DEBUG","Source data",o),t=s.jsonld2store(o),v()},error:function(t,o,r){n.addMsg(new Error,"ERROR","FAILED to load external source: "+e.source.location),n.addMsg(new Error,"ERROR","Request status: "+o+"; Error msg: "+r)}}):v()}))},t.fulleditor=function(e,t){r=document.getElementById(t);var o=$('<div class="container-fluid"><h2>Bibframe Editor Workspace</h2></div>'),i=$('<div class="tabs"></div>'),d=$('<ul class="nav nav-tabs"></ul>');d.append('<li class="active"><a data-toggle="tab" href="#browse">Browse</a></li>'),d.append('<li><a data-toggle="tab" href="#create">Editor</a></li>'),d.append('<li><a data-toggle="tab" href="#loadwork">Load Work</a></li>'),d.append('<li><a data-toggle="tab" href="#loadibc">Load IBC</a></li>'),d.append('<li><a data-toggle="tab" href="#loadmarc">Load MARC</a></li>'),i.append(d),o.append(i);var p=$('<div class="tab-content"></div>'),c=$('<div id="browse" class="tab-pane fade in active"><br></div>'),f=$('<div id="create" class="tab-pane fade"><br></div>'),g=$('<div id="loadwork" class="tab-pane fade"><br></div>'),h=$('<div id="loadibc" class="tab-pane fade"><br></div>'),m=$('<div id="loadmarc" class="tab-pane fade"><br></div>'),y=$("<div>",{id:"bfeditor-menudiv",class:"col-md-2 sidebar"}),T=$("<div>",{id:"bfeditor-formdiv",class:"col-md-10 main"}),R=$("<div>",{class:"row"}),x=$('<div><br /><br /><h2>Loading...</h2><div class="progress progress-striped active">                          <div class="progress-bar progress-bar-info" id="bfeditor-loader" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 20%">                              <span class="sr-only">80% Complete</span>                          </div>                      </div>');$("#table_id").DataTable();if(!$.fn.dataTable.isDataTable("#table_id")){var E=$('<table id="table_id" class="display"><thead><tr><th>id</th><th>name</th><th>title</th><th>LCCN</th><th>comment</th><th>modified</th><th>edit</th></tr></thead></table>');$(function(){$("#table_id").DataTable({initComplete:function(e,t){""!==window.location.hash&&$("#table_id").DataTable().search(window.location.hash.split("#")[1]).draw()},processing:!0,paging:!0,ajax:{url:e.url+"/verso/api/bfs",dataSrc:"",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"DELETE, HEAD, GET, OPTIONS, POST, PUT","Access-Control-Allow-Headers":"Content-Type, Content-Range, Content-Disposition, Content-Description","Access-Control-Max-Age":"1728000"}},columns:[{data:"id"},{data:"name",render:function(e,t,o,r){try{retval=N(e),"eundefined"===retval&&(retval=e)}catch(t){retval=e}return retval}},{data:"rdf",render:function(e,o,r,a){var i="No Title";return _.some(e,"http://id.loc.gov/ontologies/bibframe/title")?(text=_.find(e,"http://id.loc.gov/ontologies/bibframe/title")["http://id.loc.gov/ontologies/bibframe/title"],void 0!==text&&_.each(text,function(o){void 0!==o["@id"]&&(t=o["@id"],title=_.where(e,{"@id":t}),_.has(title[0],"http://id.loc.gov/ontologies/bibframe/mainTitle")?i=title[0]["http://id.loc.gov/ontologies/bibframe/mainTitle"][0]["@value"]:_.has(title[0],"http://www.w3.org/2000/01/rdf-schema#label")&&(i=title[0]["http://www.w3.org/2000/01/rdf-schema#label"][0]["@value"]))})):_.some(e,"http://www.loc.gov/mads/rdf/v1#authoritativeLabel")?void 0===(i=_.find(e,"http://www.loc.gov/mads/rdf/v1#authoritativeLabel")["http://www.loc.gov/mads/rdf/v1#authoritativeLabel"][0]["@value"])&&(i=_.find(e,"http://www.loc.gov/mads/rdf/v1#authoritativeLabel")["http://www.w3.org/2000/01/rdf-schema#label"][0]["@value"]):i="No Title",i}},{data:"rdf",render:function(t,o,r,a){var i="N/A",s=_.filter(t,function(e){if(!_.isEmpty(e["@type"])&&e["@type"][0].match("^(http|https)://id.loc.gov/ontologies/bibframe/Lccn")&&_.has(e,["http://www.w3.org/1999/02/22-rdf-syntax-ns#value"])&&!_.isEmpty(e["http://www.w3.org/1999/02/22-rdf-syntax-ns#value"][0]["@value"]))return e["http://www.w3.org/1999/02/22-rdf-syntax-ns#value"][0]["@value"]});if(!_.isEmpty(s))if(1===s.length)i=s[0]["http://www.w3.org/1999/02/22-rdf-syntax-ns#value"][0]["@value"];else for(q=0;q<s.length;q++)s[q]["http://www.w3.org/1999/02/22-rdf-syntax-ns#value"][0]["@value"].startsWith("n")||(i=s[q]["http://www.w3.org/1999/02/22-rdf-syntax-ns#value"][0]["@value"]);if("N/A"!==i&&"published"===r.status||"success"===r.status){var d=e.basedbURI+"/loc.natlib.instances.e"+i.trim()+"0001";i.trim().startsWith("n")&&(d=e.basedbURI+"/loc.natlib.works."+i.trim().replace(/\s+/g,""));var n=i.trim(),l=new $.fn.dataTable.Api(a.settings).cell(a.row,a.col);"success"===r.status?(r.objid.includes("instances/e")?l.node().innerHTML='<a href="'+d+'">'+n+"</a>":l.node().innerHTML='<a href="'+e.basedbURI+"/"+r.objid+'">'+n+"</a>",$(l.node()).css("background-color","lightgreen")):new Date(new Date(r.modified).getTime()+6e4)>new Date?$(l.node()).css("background-color","yellow"):$(l.node()).css("background-color","lightcoral")}return i}},{data:"rdf",render:function(e,t,o,r){var a="",i=_.findKey(e,"http://id.loc.gov/ontologies/bflc/metadataAssigner"),s=_.findKey(e,"https://id.loc.gov/ontologies/bflc/metadataAssigner"),d=_.findKey(e,"http://id.loc.gov/ontologies/bflc/catalogerId"),n=_.findKey(e,"https://id.loc.gov/ontologies/bflc/catalogerId");return s?a=_.pluck(e[s]["https://id.loc.gov/ontologies/bflc/metadataAssigner"],"@value")[0]:i?a=_.pluck(e[i]["http://id.loc.gov/ontologies/bflc/metadataAssigner"],"@value")[0]:n?a=_.pluck(e[n]["https://id.loc.gov/ontologies/bflc/catalogerId"],"@value")[0]:d&&(a=_.pluck(e[d]["http://id.loc.gov/ontologies/bflc/catalogerId"],"@value")[0]),a.length>60?a.substr(0,58)+"...":a}},{data:"modified",width:"10%",render:function(e,t,o){var r=new Date(e),a=r.getHours(),i=r.getMinutes(),s="a";return i<10&&(i="0"+i),a>=12&&(s="p"),a>12&&(a-=12),r.getMonth()+1+"-"+r.getDate()+"-"+r.getFullYear()+" "+a+":"+i+s}},{data:"url",width:"10%",searchable:!1,filterable:!1,sortable:!1,render:function(e,t,o,r){return'<div class="btn-group" id="retrieve-btn"><button id="bfeditor-retrieve'+o.id+'" type="button" class="btn btn-default">Edit</button>                                <button id="bfeditor-delete'+o.id+'"type="button" class="btn btn-danger" data-toggle="modal" data-target="#bfeditor-deleteConfirm'+o.id+'">Delete</button>                                </div>'},createdCell:function(e,t,o,r,i){"success"!==o.status&&"published"!==o.status||$(e).find("#bfeditor-delete"+o.id).attr("disabled","disabled");var d;S();if(s.store=[],s.loadtemplates=[],"profile:bf2:Load:Work"!==o.profile&&"profile:bf2:IBC:Instance"!==o.profile){var l=_.findIndex(_(a.startingPoints).chain().find({menuItems:[{useResourceTemplates:[o.profile]}]}).value().menuItems,{useResourceTemplates:[o.profile]});d=_(a.startingPoints).chain().find({menuItems:[{useResourceTemplates:[o.profile]}]}).value().menuItems[l]}else"profile:bf2:Load:Work"===o.profile?d={label:"Loaded Work",type:["http://id.loc.gov/ontologies/bibframe/Work"],useResourceTemplates:["profile:bf2:Load:Work"]}:"profile:bf2:IBC:Instance"===o.profile&&(d={label:"IBC",type:["http://id.loc.gov/ontologies/bibframe/Instance"],useResourceTemplates:["profile:bf2:IBC:Instance"]});var p=[];d.useResourceTemplates.forEach(function(e){S();var t={};t.templateGUID=o.name,t.resourceTemplateID=e,t.embedType="page",t.data=[],p.push(t)}),$(e).find("#bfeditor-retrieve"+o.id).click(function(){void 0!==a.retrieve.callback?(s.loadtemplates=p,s.store=[],s.state="edit",s.jsonld2store(o.rdf),s.name=o.name,s.created=o.created,s.url=o.url,s.profile=o.profile,u=o.addedproperties,$("[href=#create]").tab("show"),$("#bfeditor-messagediv").length&&($("#bfeditor-messagediv").remove(),$("#bfeditor-formdiv").show(),$("#save-btn").remove(),$("#bfeditor-previewPanel").remove()),v(),window.location.hash=N(o.name)):u=[]}),$(e).append($('<div class="modal fade" id="bfeditor-deleteConfirm'+o.id+'" role="dialog"><div class="modal-dialog modal-sm"><div class="modal-content">                               <div class="modal-body"><h4>Delete?</h4></div>                              <div class="modal-footer"><button type="button" class="btn btn-default" id="bfeditor-modalCancel" data-dismiss="modal">Cancel</button>                               <button type="button" id="bfeditor-deleteConfirmButton'+o.id+'" class="btn btn-danger btn-ok" data-dismiss="modal">Delete</button></div></div></div></div></div>')),$(e).find("#bfeditor-deleteConfirmButton"+o.id).click(function(){if(void 0!==a.deleteId.callback){a.deleteId.callback(o.id,a.getCSRF.callback(),n);$("#table_id").DataTable();s.store=[]}}),$(e).find("#bfeditor-deleteConfirm"+o.id).on("hidden.bs.modal",function(){var e=$("#table_id").DataTable();s.store=[],e.ajax.reload()})}}]})}),c.append(E)}T.append(x),y.append("<h3>Create Resource</h3>"),R.append(y),R.append(T),f.append(R);var I=$('<div class="container">               <form role="form" method="get">               <div class="form-group">               <label for="url">URL for Bibframe JSON Work</label>               <input id="bfeditor-loadworkuriInput" class="form-control" placeholder="Enter URL for Bibframe" type="text" name="url" id="url">               <div id="bfeditor-loadwork-dropdown" class="dropdown"><select id="bfeditor-loadwork-dropdownMenu" type="select" class="form-control">Select Profile</select>               </div></div>               <button id="bfeditor-loadworkuri" type="button" class="btn btn-primary">Submit URL</button>               </form></div>');!function(t){for(var o=0;o<e.startingPoints.length;o++)for(var r=e.startingPoints[o],a=r.menuGroup,i=0;i<r.menuItems.length;i++){var s=$("<option>",{class:"dropdown-item",value:"sp-"+o+"_"+i});"http://id.loc.gov/ontologies/bibframe/Work"===r.menuItems[i].type[0]&&(s.html(a),t.append(s))}}(I.find("#bfeditor-loadwork-dropdownMenu")),g.append(I),g.find("#bfeditor-loadworkuri").click(function(){var t=$(this.parentElement).find("#bfeditor-loadwork-dropdownMenu").val().replace("sp-","").split("_"),o=a.startingPoints[t[0]].menuItems[t[1]];$("#bfeditor-messagediv").length&&$("#bfeditor-messagediv").remove(),bfeditor.bfestore.store=[],bfeditor.bfestore.name=S(),bfeditor.bfestore.created=(new Date).toUTCString(),bfeditor.bfestore.url=e.url+"/verso/api/bfs?filter=%7B%22name%22%3A%20%22"+bfeditor.bfestore.name+"%22%7D",bfeditor.bfestore.state="loaduri",bfeditor.bfestore.profile=o.useResourceTemplates[0],loadtemplatesCount=o.useResourceTemplates.length;var r=[];if(o.useResourceTemplates.forEach(function(e){var t=S(),o={};o.templateGUID=t,o.resourceTemplateID=e,o.embedType="page",o.data=[],r.push(o)}),void 0!==a.retrieve.callback)try{s.loadtemplates=r;var i=$(this.parentElement).find("#bfeditor-loadworkuriInput").val();a.retrieve.callback(i,s,s.loadtemplates,n,function(e){_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Person"}),function(e){e.o="http://www.loc.gov/mads/rdf/v1#PersonalName"}),_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Organization"}),function(e){e.o="http://www.loc.gov/mads/rdf/v1#CorporateName"}),_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bflc/PrimaryContribution"}),function(e){bfeditor.bfestore.store=_.reject(bfeditor.bfestore.store,_.find(bfeditor.bfestore.store,{s:e.s,p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Contribution"}))}),_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Text"}),function(e){bfeditor.bfestore.store=_.reject(bfeditor.bfestore.store,_.find(bfeditor.bfestore.store,{s:e.s,p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Text"}))}),s.loadtemplates.data=bfeditor.bfestore.store,$("[href=#create]").tab("show"),$("#bfeditor-formdiv").show(),$("#bfeditor-messagediv").length&&$("#bfeditor-messagediv").remove(),_.each(bfeditor.bfestore.store,function(e){e.o.startsWith("_:_:")&&(e.o="_:"+e.o.split("_:")[2])}),v()})}catch(e){$(this.parentElement).find("#bfeditor-loadworkuriInput").val("An error occured: "+e.message)}else $(this.parentElement).find("#bfeditor-loadworkuriInput").val("This function has been disabled")});var k=function(t){for(var o=0;o<e.startingPoints.length;o++)for(var r=e.startingPoints[o],a=r.menuGroup,i=0;i<r.menuItems.length;i++){var s=$("<option>",{class:"dropdown-item",value:"sp-"+o+"_"+i});"http://id.loc.gov/ontologies/bibframe/Instance"!==r.menuItems[i].type[0]&&"http://id.loc.gov/ontologies/bibframe/Serial"!==r.menuItems[i].type[0]||(s.html(a),t.append(s))}},D=$('<div class="container">               <form role="form" method="get">               <div class="form-group">               <label for="url">URL for Bibframe JSON</label>               <input id="bfeditor-loadibcuriInput" class="form-control" placeholder="Enter URL for Bibframe" type="text" name="url" id="url">               <div id="bfeditor-loadibc-dropdown" class="dropdown"><select id="bfeditor-loadibc-dropdownMenu" type="select" class="form-control">Select Profile</select>               </div></div>               <button id="bfeditor-loadibcuri" type="button" class="btn btn-primary">Submit URL</button>               </form></div>');k(D.find("#bfeditor-loadibc-dropdownMenu")),h.append(D),h.find("#bfeditor-loadibcuri").click(function(){var t=$(this.parentElement).find("#bfeditor-loadibc-dropdownMenu").val().replace("sp-","").split("_"),o=a.startingPoints[t[0]].menuItems[t[1]];$("#bfeditor-messagediv").length&&$("#bfeditor-messagediv").remove(),bfeditor.bfestore.store=[],bfeditor.bfestore.name=S(),bfeditor.bfestore.created=(new Date).toUTCString(),bfeditor.bfestore.url=e.url+"/verso/api/bfs?filter=%7B%22name%22%3A%20%22"+bfeditor.bfestore.name+"%22%7D",bfeditor.bfestore.state="loaduri",bfeditor.bfestore.profile=o.useResourceTemplates[0],loadtemplatesCount=o.useResourceTemplates.length;var r=[];if(o.useResourceTemplates.forEach(function(e){var t=S(),o={};o.templateGUID=t,o.resourceTemplateID=e,o.embedType="page",o.data=[],r.push(o)}),void 0!==a.retrieveLDS.callback)try{s.loadtemplates=r;var i=$(this.parentElement).find("#bfeditor-loadibcuriInput").val();if(i.trim().includes("instance"))a.retrieveLDS.callback(i,s,s.loadtemplates,n,function(e){if(_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Person"}),function(e){e.o="http://www.loc.gov/mads/rdf/v1#PersonalName"}),_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Organization"}),function(e){e.o="http://www.loc.gov/mads/rdf/v1#CorporateName"}),_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bflc/PrimaryContribution"}),function(e){var t=_.find(bfeditor.bfestore.store,{s:e.s,p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Contribution"});_.isEmpty(t)||(bfeditor.bfestore.store=_.reject(bfeditor.bfestore.store,t))}),_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Publication"}),function(e){var t=_.find(bfeditor.bfestore.store,{s:e.s,p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/ProvisionActivity"});_.isEmpty(t)||(bfeditor.bfestore.store=_.reject(bfeditor.bfestore.store,t))}),_.some(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bflc/itemOf"}))_.find(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bflc/itemOf"});_.each(_.where(bfeditor.bfestore.store,{p:"http://id.loc.gov/ontologies/bibframe/adminMetadata"}),function(e){var t={};t.s=e.o,t.p="http://id.loc.gov/ontologies/bflc/profile",t.o=bfeditor.bfestore.profile,t.otype="literal",bfeditor.bfestore.store.push(t),(t={}).s=e.o,t.p="http://id.loc.gov/ontologies/bflc/procInfo",t.o="ibc update",t.otype="literal",bfeditor.bfestore.store.push(t)}),s.loadtemplates.data=bfeditor.bfestore.store,$("[href=#create]").tab("show"),$("#bfeditor-formdiv").show(),$("#bfeditor-messagediv").length&&$("#bfeditor-messagediv").remove(),v()});else{msg="Please choose an instance";var d=$("<div>",{id:"bfeditor-messagediv",class:"main"});d.append('<div class="alert alert-danger" role="alert"><strong>Please choose an instance to load</strong></a></div>'),d.insertBefore(".nav-tabs")}}catch(e){$(this.parentElement).find("#bfeditor-loadworkuriInput").val("An error occured: "+e.message)}else $(this.parentElement).find("#bfeditor-loadworkuriInput").val("This function has been disabled")}),m.append($('<div class="container">               <form role="form" method="get">               <div class="form-group">               <label for="marcdx">Bib ID or LCCN</label>               <div class="input-group">               <div class="input-group-btn">               <button type="button" id="marcdx" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Bib ID <span class="caret"></span></button>               <ul class="dropdown-menu">               <li><a href="#" id="bibid">Bib ID</a></li>               <li><a href="#" id="lccn">LCCN</a></li>               </ul></div>               <input id="bfeditor-loadmarcterm" class="form-control" placeholder="Enter Bib ID or LCCN" type="text" name="url"></div>               <input type="hidden" id="loadmarc-uri"></hidden>              <label for="bfeditor-loadmarc-dropdown">Choose Profile</label>               <div id="bfeditor-loadmarc-dropdown" class="dropdown"><select id="bfeditor-loadmarc-dropdownMenu" type="select" class="form-control">Select Profile</select></div></div>               <button id="bfeditor-loadmarc" type="button" class="btn btn-primary">Submit</button>               </form></div>')),k(m.find("#bfeditor-loadmarc-dropdownMenu")),m.find(".dropdown-menu > li > a").click(function(){$("#marcdx").html($(this).text()+' <span class="caret">')}),m.find("#bfeditor-loadmarc").click(function(){var e=$("#bfeditor-loadmarcterm").val(),t="rec.id";$("#marcdx").text().match(/LCCN/i)&&(t="bath.lccn");var o="http://lx2.loc.gov:210/LCDB?query="+t+"="+e+"&recordSchema=bibframe2a&maximumRecords=1";$("#loadmarc-uri").attr("value",o)}),p.append(c),p.append(f),p.append(g),p.append(h),p.append(m),p.find("#bfeditor-loaduri, #bfeditor-loadmarc").click(function(){var t={};if("bfeditor-loadmarc"==this.id){var o=$(this.parentElement).find("#bfeditor-loadmarc-dropdownMenu").val().replace("sp-","").split("_");t=a.startingPoints[o[0]].menuItems[o[1]],bfeditor.bfestore.state="loadmarc"}else t={label:"Loaded Work",type:["http://id.loc.gov/ontologies/bibframe/Work"],useResourceTemplates:["profile:bf2:Monograph:Work"]},bfeditor.bfestore.state="loaduri";bfeditor.bfestore.store=[],bfeditor.bfestore.name=S(),bfeditor.bfestore.created=(new Date).toUTCString(),bfeditor.bfestore.url=e.url+"/verso/api/bfs?filter=%7B%22name%22%3A%20%22"+bfeditor.bfestore.name+"%22%7D",bfeditor.bfestore.profile=t.useResourceTemplates[0],loadtemplatesCount=t.useResourceTemplates.length;var r=[];if(t.useResourceTemplates.forEach(function(e){var t=S(),o={};o.templateGUID=t,o.resourceTemplateID=e,o.embedType="page",o.data=[],r.push(o)}),void 0!==a.retrieve.callback)try{s.loadtemplates=r;var i=$(this.parentElement).find("#bfeditor-loaduriInput, #loadmarc-uri").val();a.retrieve.callback(i,s,s.loadtemplates,n,function(e){_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Person"}),function(e){e.o="http://www.loc.gov/mads/rdf/v1#PersonalName"}),_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Organization"}),function(e){e.o="http://www.loc.gov/mads/rdf/v1#CorporateName"}),_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bflc/PrimaryContribution"}),function(e){bfeditor.bfestore.store=_.reject(bfeditor.bfestore.store,_.find(bfeditor.bfestore.store,{s:e.s,p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Contribution"}))}),_.each(_.where(bfeditor.bfestore.store,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Text"}),function(e){bfeditor.bfestore.store=_.reject(bfeditor.bfestore.store,_.find(bfeditor.bfestore.store,{s:e.s,p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",o:"http://id.loc.gov/ontologies/bibframe/Text"}))}),s.loadtemplates.data=bfeditor.bfestore.store,$("[href=#create]").tab("show"),$("#bfeditor-formdiv").show(),$("#bfeditor-messagediv").length&&$("#bfeditor-messagediv").remove(),_.each(bfeditor.bfestore.store,function(e){void 0!==e.o&&e.o.startsWith("_:_:")&&(e.o="_:"+e.o.split("_:")[2])}),v()})}catch(e){$(this.parentElement).find("#bfeditor-loaduriInput").val("An error occured: "+e.message)}else $(this.parentElement).find("#bfeditor-loaduriInput").val("This function has been disabled")}),o.append(p),$(r).append(o),this.setConfig(e);for(var j=0;j<e.startingPoints.length;j++){var U=e.startingPoints[j],C=$("<ul>",{class:"nav nav-sidebar"}),L=null;if(void 0!==typeof U.menuGroup&&""!==U.menuGroup){var O=$('<li><a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">'+U.menuGroup+'<span class="caret"></span></a></li>');L=$('<ul class="dropdown-menu"></ul>'),O.append(L),C.append(O)}for(var q=0;q<U.menuItems.length;q++){var M=$("<li>"),A=$("<a>",{href:"#",id:"sp-"+j+"_"+q});A.html(U.menuItems[q].label),A.click(function(){$("#bfeditor-messagediv").remove(),$("#bfeditor-formdiv").show(),$("#save-btn").remove(),$("#bfeditor-previewPanel").remove(),w(this.id)}),M.append(A),null!==L?L.append(M):C.append(M)}y.append(C)}if(void 0!==a.logging&&void 0!==a.logging.level&&"DEBUG"==a.logging.level){var P=$('<div id="bfeditor-debugdiv" class="col-md-12 main panel-group">                           <div class="panel panel-default"><div class="panel-heading">                           <h3 class="panel-title"><a role="button" data-toggle="collapse" href="#debuginfo">Debug output</a></h3></div>                           <div class="panel-collapse collapse in" id="debuginfo"><div class="panel-body"><pre id="bfeditor-debug"></pre></div></div></div>                           </div>');$(r).append(P),$("#bfeditor-debug").html(JSON.stringify(l,void 0," "))}var B=$("<footer>",{class:"footer"});return $(r).append(B),0===b&&T.html(""),$('a[data-toggle="tab"]').click(function(e){$("#bfeditor-messagediv").remove()}),{profiles:l,div:r,bfestore:s,bfelog:n}},t.editor=function(e,t){this.setConfig(e),r=document.getElementById(t);var o=$("<div>",{id:"bfeditor-formdiv",class:"col-md-12"}),i=$("<div>",{class:"row"});if(i.append(o),$(r).append(i),void 0!==a.logging&&void 0!==a.logging.level&&"DEBUG"==a.logging.level){var d=$("<div>",{class:"col-md-12"});d.html("Debug output");var p=$("<pre>",{id:"bfeditor-debug"});d.append(p),$(r).append(d),p.html(JSON.stringify(l,void 0," "))}var c=$("<div>",{class:"col-md-12"});return $(r).append(c),{profiles:l,div:r,bfestore:s,bfelog:n}}}),bfe.define("src/bfestore",["require","exports","module"],function(e,t,o){function r(){function e(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=0;o<1;o++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}return e()+e()+e()+parseInt(Date.now()/1e3)}t.n3store=N3.Store(),t.store=[],t.rdfxml2store=function(e,t,o,r){var a="http://rdf-translator.appspot.com/convert/xml/json-ld/content",i=this;$.ajax({contentType:"application/x-www-form-urlencoded",type:"POST",async:!1,data:{content:e},url:a,success:function(e){i.store=i.jsonldcompacted2store(e,function(e){i.store=[],tempstore=i.jsonld2store(e),tempstore.forEach(function(e){e.s=e.s.replace(/^_:N/,"_:bnode"),e.s=e.s.replace(/bibframe.example.org\/.+#(Work|Topic).*/,"id.loc.gov/resources/works/c"+o),e.s=e.s.replace(/bibframe.example.org\/.+#Instance.*/,"id.loc.gov/resources/instances/c"+o+"0001"),e.s=e.s.replace(/bibframe.example.org\/.+#Item.*/,"id.loc.gov/resources/items/c"+o+"0001"),void 0!==e.o&&(e.o=e.o.replace(/^_:N/,"_:bnode"),e.o=e.o.replace(/bibframe.example.org\/.+#(Work|Topic).*/,"id.loc.gov/resources/works/c"+o),e.o=e.o.replace(/bibframe.example.org\/.+#Instance.*/,"id.loc.gov/resources/instances/c"+o+"0001"),e.o=e.o.replace(/bibframe.example.org\/.+#Item.*/,"id.loc.gov/resources/items/c"+o+"0001")),console.log(e)}),r(t)})},error:function(e,t,o){bfelog.addMsg(new Error,"ERROR","FAILED to load external source: "+a),bfelog.addMsg(new Error,"ERROR","Request status: "+t+"; Error msg: "+o)}})},t.addTriple=function(e){t.store.push(e),void 0!==e.rtid?t.n3store.addTriple(e.s,e.p,e.o,e.rtID):t.n3store.addTriple(e.s,e.p,e.o)},t.storeDedup=function(){return t.store=_.uniq(t.store,function(e){return void 0!==e.olang?e.s+e.p+e.o+e.otype+e.olang:void 0!==e.odatatype?e.s+e.p+e.o+e.otype+e.odatatype:void 0!==e.rtID?e.s+e.p+e.o+e.otype+e.rtID+e.guid:e.s+e.p+e.o+e.otype}),t.store},t.store2rdfxml=function(e,o){t.store2jsonldnormalized(e,function(t){e.toRDF(t,{format:"application/nquads"},function(e,t){var o=N3.Parser(),r=N3.Store();o.parse(t,function(e,t,o){if(t)r.addTriple(t);else{r.addPrefixes(o);var a=N3.Writer({prefixes:{bf:"http://id.loc.gov/ontologies/bibframe/",bflc:"http://id.loc.gov/ontologies/bflc/",madsrdf:"http://www.loc.gov/mads/rdf/v1#",pmo:"http://performedmusicontology.org/ontology/",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",xsd:"http://www.w3.org/2001/XMLSchema#"}});a.addTriples(r.getTriples(null,null,null)),a.end(function(e,t){var o={};o.n3=t,$.ajax({url:config.url+"/profile-edit/server/n3/rdfxml",type:"POST",data:JSON.stringify(o),processData:!1,contentType:"application/json",success:function(e){var t=(new XMLSerializer).serializeToString(e);$("#rdfxml .panel-body pre").text(t)},error:function(e,t,o){console.log(o)}})})}})})})},t.n32store=function(e,o,r,a){var i=N3.Parser().parse(e),s=N3.Writer({format:"N-Quads"});N3.Store(i).getTriples(null,null,null).forEach(function(e){s.addTriple(e.subject.replace("_bnode",""),e.predicate,e.object.replace("_bnode",""),o)}),s.end(function(e,o){jsonld.fromRDF(o,{format:"application/nquads"},function(e,o){a(t.jsonld2store(o[0]["@graph"]))})})},t.jsonld2store=function(e){return e.forEach(function(e){var o=void 0!==e["@id"]?e["@id"]:"_:b"+r();for(var a in e)if("@id"!==a)if("@type"!==a||_.isArray(e[a]))e[a].forEach(function(e){var i=r(),s={};s.guid=i,"@type"===a?(s.s=o,s.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",e.indexOf(".html")>-1?s.o=e.replace(".html",""):s.o=e,s.otype="uri"):(s.s=o,a.indexOf(".html")>-1?s.p=a.replace(".html",""):s.p=a,void 0!==e["@id"]?(s.o=e["@id"],s.otype="uri"):void 0!==e["@value"]&&(s.o=e["@value"],s.otype="literal",void 0!==e["@language"]&&(s.olang=e["@language"]))),t.store.push(s)});else{var i=r(),s={};s.guid=i,s.s=o,s.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",s.o=e["@type"],s.otype="uri",t.store.push(s)}}),t.store},t.store2jsonldExpanded=function(){var e=[];t.storeDedup();var o=_.groupBy(t.store,function(e){return e.s});for(var r in o){var a={};a["@id"]=r;var i=_.groupBy(o[r],function(e){return e.p});for(var s in i){var d=s;"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"==s&&(d="@type"),a[d]=[],i[s].forEach(function(e){if("@type"==d&&"uri"==e.otype)a[d].push(e.o);else if("uri"==e.otype)a[d].push({"@id":e.o});else{var t={};void 0!==e.olang&&""!==e.olang&&(t["@language"]=e.olang),"@type"==e.p?t=e.o:t["@value"]=e.o,a[d].push(t)}})}(a["@id"].startsWith("_:b")||a["@id"].includes("loc.natlib"))&&_.keys(a).length<3||e.push(a)}return e},t.store2turtle=function(e,t){jsonld.toRDF(e,{format:"application/nquads"},function(e,o){var r=N3.Parser(),a=N3.Store();r.parse(o,function(e,o,r){if(o)a.addTriple(o);else{a.addPrefixes(r);var i=N3.Writer({prefixes:{bf:"http://id.loc.gov/ontologies/bibframe/",bflc:"http://id.loc.gov/ontologies/bflc/",madsrdf:"http://www.loc.gov/mads/rdf/v1#",pmo:"http://performedmusicontology.org/ontology/",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",xsd:"http://www.w3.org/2001/XMLSchema#"}});i.addTriples(a.getTriples(null,null,null)),i.end(function(e,o){t(o)});var s={};s.n3=$("#humanized .panel-body pre").text(),$.ajax({url:config.url+"/profile-edit/server/n3/rdfxml",type:"POST",data:JSON.stringify(s),processData:!1,contentType:"application/json",success:function(e){var t=(new XMLSerializer).serializeToString(e);$("#rdfxml .panel-body pre").text(t)},error:function(e,t,o){console.log(o)}})}})})},t.store2jsonldcompacted=function(e,t){context={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",xsd:"http://www.w3.org/2001/XMLSchema#",bf:"http://id.loc.gov/ontologies/bibframe/",bflc:"http://id.loc.gov/ontologies/bflc/",madsrdf:"http://www.loc.gov/mads/rdf/v1#",pmo:"http://performedmusicontology.org/ontology/"},jsonld.compact(e,context,function(e,o){t(o)})},t.store2jsonldnormalized=function(e,t){jsonld.expand(e,context,function(e,o){t(o)})},t.jsonldcompacted2store=function(e,t){jsonld.expand(e,function(e,o){t(o)})},t.store2text=function(){var e="\n",o="";return t.store2jsonldExpanded().forEach(function(t){for(var r in o+="\nID: "+t["@id"],void 0!==t["@type"]&&(o+="\n\tType(s)",t["@type"].forEach(function(e){void 0!==e["@value"]?o+="\n\t\t"+e["@value"]:o+="\n\t\t"+e})),t)if("@type"!==r&&"@id"!==r){var a=r.replace("http://id.loc.gov/ontologies/bibframe/","bf:");a=(a=(a=a.replace("http://id.loc.gov/vocabulary/relators/","relators:")).replace("http://id.loc.gov/ontologies/bibframe-lc/","bflc:")).replace("http://rdaregistry.info/termList/","rda"),o+="\n\t"+a,t[r].forEach(function(e){void 0!==e["@id"]?o+="\n\t\t"+e["@id"]:o+="\n\t\t"+e["@value"]})}o+=e+e}),o}}),bfe.define("src/bfelogging",["require","exports","module"],function(e,t,o){var r="INFO",a=!0,i=window.location.protocol+"//"+window.location.host+"/";function s(e,t,o,r){a&&(console.log(o.fileName+":"+o.lineNumber+" -> "+t),("object"==typeof t||t instanceof Array)&&console.log(t),void 0!==r&&("object"==typeof r||r instanceof Array)&&console.log(r))}function d(e,o,r,a){var i=new Date,s=i.toJSON(),d=i.toLocaleString(),n={};n.dt=i,n.dtLocaleSort=s,n.dtLocaleReadable=d,n.type=e,n.fileName=r.fileName,n.lineNumber=r.lineNumber,"object"==typeof o||o instanceof Array?n.msg=JSON.stringify(o):n.msg=o,void 0!==a&&("object"==typeof a||a instanceof Array)&&(n.obj=JSON.stringify(a)),t.log.push(n)}t.log=[],t.getLog=function(){return t.log},t.init=function(e){void 0!==e.logging&&(void 0!==e.logging.level&&"DEBUG"==e.logging.level&&(r=e.logging.level),void 0===e.logging.toConsole||e.logging.toConsole||(a=e.logging.toConsole));var o="Logging instantiated: level is "+r+"; log to console is set to "+a;t.addMsg(new Error,"INFO",o),t.addMsg(new Error,"INFO",i)},t.addMsg=function(e,t,o,a){if(void 0===e.lineNumber&&void 0===e.fileName)try{var n=e.stack.split("\n"),l=n[1].substring(n[1].indexOf("(")+1),p=(l=l.replace(i,"")).split(":");e.fileName=p[0],e.lineNumber=p[1]}catch(t){e.fileName="unknown",e.lineNumber="?"}e.fileName=e.fileName.replace(i,""),"INFO"==r&&t.match(/INFO|WARN|ERROR/)?(d(t,o,e,a),s(t,o,e,a)):"DEBUG"==r&&(d(t,o,e,a),s(t,o,e,a))}}),bfe.define("src/lookups/lcnames",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://id.loc.gov/authorities/names",t.source=function(e,o,i){var s=i.store,d="",n=_.where(s,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"});void 0!==n[0]&&(d=n[0].o);var l="http://id.loc.gov/authorities/names";void 0!==(n=_.where(s,{p:"http://id.loc.gov/ontologies/bibframe/authoritySource"}))[0]&&(console.log(n[0]),l=n[0].o);var p="";"http://www.loc.gov/mads/rdf/v1#PersonalName"==d?p="rdftype:PersonalName":"http://id.loc.gov/ontologies/bibframe/Topic"==d?p="(rdftype:Topic OR rdftype:ComplexSubject)":"http://www.loc.gov/mads/rdf/v1#place"==d?p="rdftype:Geographic":"http://www.loc.gov/mads/rdf/v1#organization"==d?p="rdftype:CorporateName":"http://www.loc.gov/mads/rdf/v1#family"==d?p="rdftype:PersonalName":"http://www.loc.gov/mads/rdf/v1#meeting"==d?p="rdftype:ConferenceName":"http://www.loc.gov/mads/rdf/v1#jurisdiction"==d?p="rdftype:CorporateName":"http://id.loc.gov/ontologies/bibframe/genreForm"==d?p="rdftype:GenreForm":"http://id.loc.gov/ontologies/bibframe/role"==d&&(p="rdftype:Role");var c="";""!==l&&""!==p?c="cs:"+l+" AND "+p:""!==p?c=p:""!==l&&(c="cs:"+l),c=""!==c?c+" AND ("+e+" OR "+e+"* OR *"+e+"*)":"("+e+" OR "+e+"* OR *"+e+"*)",c=encodeURI(c),a[c]?o(a[c]):(void 0!==this.searching&&(clearTimeout(this.searching),o([])),this.searching=setTimeout(function(){if(e.length>2&&"?"!=e.substr(0,1)&&!e.match(/^[Nn][A-z]{0,1}\d/))suggestquery=e.normalize(),console.log(e),""!==p&&(suggestquery+="&rdftype="+p.replace("rdftype:","")),u=t.scheme+"/suggest/?q="+suggestquery+"&count=50",$.ajax({url:u,dataType:"jsonp",success:function(t){return parsedlist=r.processSuggestions(t,e),a[c]=parsedlist,o(parsedlist)}});else{if(!(e.length>2))return[];u="http://id.loc.gov/search/?format=jsonp&start=1&count=50&q="+c.replace("?",""),$.ajax({url:u,dataType:"jsonp",success:function(t){return parsedlist=r.processATOM(t,e),a[c]=parsedlist,o(parsedlist)}})}},300))},t.getResource=r.getResourceWithAAP}),bfe.define("src/lookups/lcshared",["require","exports","module"],function(e,t,o){t.getResource=function(e,t,o,r){var a=[],i={};return i.s=e,i.p=t.propertyURI,o.uri=o.uri,i.o=o.uri,i.otype="uri",a.push(i),(i={}).s=o.uri,i.p="http://www.w3.org/2000/01/rdf-schema#label",i.o=o.value,i.otype="literal",i.olang="en",a.push(i),r(a,t)},t.getResourceWithAAP=function(e,t,o,r){var a=[],i={};i.s=e,i.p=t.propertyURI,i.o=o.uri,i.otype="uri",a.push(i),(i={}).s=e,i.p="http://www.w3.org/2000/01/rdf-schema#label",i.o=o.value,i.otype="literal",i.olang="en",a.push(i),r(a,t)},t.getResourceLabelLookup=function(e,t,o,r){var a=[],i={};i.s=e,i.p=t,i.o=o.uri,i.otype="uri",a.push(i),$.ajax({url:o.uri+".jsonp",dataType:"jsonp",success:function(e){e.forEach(function(e){if(e["@id"]===o.uri){var t={};return t.s=o.uri,t.otype="literal",t.p="http://www.w3.org/2000/01/rdf-schema#label",t.o=e["http://www.loc.gov/mads/rdf/v1#authoritativeLabel"][0]["@value"],a.push(t),r(a)}})}})},t.processJSONLDSuggestions=function(e,t,o){var r=[];if(void 0!==e["@graph"])for(var a=0;a<e["@graph"].length;a++)if(void 0!==e["@graph"][a].inScheme&&"Concept"===e["@graph"][a]["@type"]&&e["@graph"][a].inScheme===o){if(void 0!==e["@graph"][a].prefLabel.en.length)var i=e["@graph"][a].prefLabel.en;var s=e["@graph"][a]["@id"];r.push({uri:s,value:i})}return 0===r.length&&(r[0]={uri:"",value:"[No suggestions found for "+t+".]"}),r},t.processSuggestions=function(e,t){var o=[];if(void 0!==e[1])for(var r=0;r<e[1].length;r++){var a=e[1][r],i=e[3][r],s=a+" ("+i.replace(/.+\/(.+)/,"$1")+")";if(5===e.length)var d=a+" ("+e[4][r]+")";else d=a;o.push({uri:i,value:d,display:s})}return 0===o.length&&(o[0]={uri:"",display:"[No suggestions found for "+t+".]"}),o},t.processATOM=function(e,t){var o=[];for(var r in e)if("atom:entry"==e[r][0]){var a="",i="",s="",d="";for(var n in e[r]){if("atom:title"==e[r][n][0]&&(a=e[r][n][2]),"atom:link"==e[r][n][0])s=(i=e[r][n][1].href).substr(0,i.lastIndexOf("/")),d=a+" ("+i.replace(/.+\/(.+)/,"$1")+")";if(""!==a&&""!==i){o.push({uri:i,source:s,value:a,display:d});break}console.log(o)}}return 0===o.length&&(o[0]={uri:"",display:"[No suggestions found for "+t+".]"}),o},t.simpleQuery=function(e,o,r,a){console.log("q is "+e),q=encodeURI(e.normalize()),o[q]?a(o[q]):(void 0!==this.searching&&(clearTimeout(this.searching),a([])),this.searching=setTimeout(function(){if(""===e||" "===e)u=r+"/suggest/?count=100&q=",$.ajax({url:u,dataType:"jsonp",success:function(e){return parsedlist=t.processSuggestions(e,""),a(parsedlist)}});else{if(!(e.length>=1))return[];u=r+"/suggest/?count=50&q="+q,$.ajax({url:u,dataType:"jsonp",success:function(r){return parsedlist=t.processSuggestions(r,e),o[q]=parsedlist,a(parsedlist)}})}},300))}}),bfe.define("src/lookups/lcsubjects",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://id.loc.gov/authorities/subjects",t.source=function(e,o,i){var s=i.store,d="",n=_.where(s,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"});void 0!==n[0]&&(d=n[0].o);var l="http://id.loc.gov/authorities/subjects";void 0!==(n=_.where(s,{p:"http://id.loc.gov/ontologies/bibframe/authoritySource"}))[0]&&(l=n[0].o);var p="";"http://www.loc.gov/mads/rdf/v1#Person"==d?p="rdftype:PersonalName":"http://id.loc.gov/ontologies/bibframe/Topic"==d?p="(rdftype:Topic OR rdftype:ComplexSubject)":"http://www.loc.gov/mads/rdf/v1#Place"==d?p="rdftype:Geographic":"http://www.loc.gov/mads/rdf/v1#Organization"==d?p="rdftype:CorporateName":"http://www.loc.gov/mads/rdf/v1#Family"==d?p="rdftype:PersonalName":"http://www.loc.gov/mads/rdf/v1#Meeting"==d?p="rdftype:ConferenceName":"http://www.loc.gov/mads/rdf/v1#Jurisdiction"==d?p="rdftype:CorporateName":"http://id.loc.gov/ontologies/bibframe/GenreForm"==d&&(p="rdftype:GenreForm");var c="";""!==l&&""!==p?c="cs:"+l+" AND "+p:""!==p?c=p:""!==l&&(c="cs:"+l),c=""!==c?c+" AND ("+e+" OR "+e+"* OR *"+e+"*)":"("+e+" OR "+e+"* OR *"+e+"*)",c=encodeURI(c),a[c]?o(a[c]):(void 0!==this.searching&&(clearTimeout(this.searching),o([])),this.searching=setTimeout(function(){if(e.length>2&&"?"!=e.substr(0,1)&&!e.match(/[Ss][A-z]{0,1}\d/))suggestquery=e.normalize(),""!==p&&(suggestquery+="&rdftype="+p.replace("rdftype:","")),u=t.scheme+"/suggest/?q="+suggestquery,$.ajax({url:u,dataType:"jsonp",success:function(t){return parsedlist=r.processSuggestions(t,e),a[c]=parsedlist,o(parsedlist)}});else{if(!(e.length>2))return[];u="http://id.loc.gov/search/?format=jsonp&start=1&count=50&q="+c.replace("?",""),$.ajax({url:u,dataType:"jsonp",success:function(t){return parsedlist=r.processATOM(t,e),a[c]=parsedlist,o(parsedlist)}})}},300))},t.getResource=r.getResourceWithAAP}),bfe.define("src/lookups/lcgenreforms",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://id.loc.gov/authorities/genreForms",t.source=function(e,t){var o="http://id.loc.gov/authorities/genreForms",i="rdftype:GenreForm",s="";s=""!==(s="cs:"+o+" AND "+i)?s+" AND ("+e+" OR "+e+"* OR *"+e+"*)":"("+e+" OR "+e+"* OR *"+e+"*)",console.log("q is "+s),s=encodeURI(s),a[s]?t(a[s]):(void 0!==this.searching&&(console.log("searching defined"),clearTimeout(this.searching),t([])),this.searching=setTimeout(function(){if(!(e.length>2)||e.match(/[Gg][A-z]?\d/))return[];suggestquery=e,suggestquery+="&rdftype="+i.replace("rdftype:",""),u=o+"/suggest/?q="+suggestquery,$.ajax({url:u,dataType:"jsonp",success:function(o){return parsedlist=r.processSuggestions(o,e),a[s]=parsedlist,t(parsedlist)}})},300))},t.getResource=r.getResourceWithAAP}),bfe.define("src/lookups/rdaformatnotemus",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://rdaregistry.info/termList/FormatNoteMus",t.source=function(e,o){console.log("q is "+e),q=encodeURI(e),a[q]?o(a[q]):(void 0!==this.searching&&(clearTimeout(this.searching),o([])),this.searching=setTimeout(function(){if(""===e||" "===e)u=t.scheme+".json-ld",$.ajax({url:u,dataType:"json",success:function(a){return parsedlist=r.processJSONLDSuggestions(a,e,t.scheme),o(parsedlist)}});else{if(!(e.length>1))return[];u=t.scheme+".json-ld",console.log(u),$.ajax({url:u,dataType:"json",success:function(i){return parsedlist=r.processJSONLDSuggestions(i,e,t.scheme),a[q]=parsedlist,o(parsedlist)}})}},300))},t.getResource=r.getResource}),bfe.define("src/lookups/rdamediatype",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://rdaregistry.info/termList/RDAMediaType",t.source=function(e,o){console.log("q is "+e),q=encodeURI(e),a[q]?o(a[q]):(void 0!==this.searching&&(clearTimeout(this.searching),o([])),this.searching=setTimeout(function(){if(""===e||" "===e)u=t.scheme+".json-ld",$.ajax({url:u,dataType:"json",success:function(a){return parsedlist=r.processJSONLDSuggestions(a,e,t.scheme),o(parsedlist)}});else{if(!(e.length>1))return[];u=t.scheme+".json-ld",console.log(u),$.ajax({url:u,dataType:"json",success:function(i){return parsedlist=r.processJSONLDSuggestions(i,e,t.scheme),a[q]=parsedlist,o(parsedlist)}})}},300))},t.getResource=r.getResource}),bfe.define("src/lookups/rdamodeissue",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://rdaregistry.info/termList/ModeIssue",t.source=function(e,o){console.log("q is "+e),q=encodeURI(e),a[q]?o(a[q]):(void 0!==this.searching&&(clearTimeout(this.searching),o([])),this.searching=setTimeout(function(){if(""===e||" "===e)u=t.scheme+".json-ld",$.ajax({url:u,dataType:"json",success:function(a){return parsedlist=r.processJSONLDSuggestions(a,e,t.scheme),o(parsedlist)}});else{if(!(e.length>1))return[];u=t.scheme+".json-ld",console.log(u),$.ajax({url:u,dataType:"json",success:function(i){return parsedlist=r.processJSONLDSuggestions(i,e,t.scheme),a[q]=parsedlist,o(parsedlist)}})}},300))},t.getResource=r.getResource}),bfe.define("src/lookups/rdacarriertype",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://rdaregistry.info/termList/RDACarrierType",t.source=function(e,o){console.log("q is "+e),q=encodeURI(e),a[q]?o(a[q]):(void 0!==this.searching&&(clearTimeout(this.searching),o([])),this.searching=setTimeout(function(){if(""===e||" "===e)u=t.scheme+".json-ld",$.ajax({url:u,dataType:"json",success:function(a){return parsedlist=r.processJSONLDSuggestions(a,e,t.scheme),o(parsedlist)}});else{if(!(e.length>1))return[];u=t.scheme+".json-ld",console.log(u),$.ajax({url:u,dataType:"json",success:function(i){return parsedlist=r.processJSONLDSuggestions(i,e,t.scheme),a[q]=parsedlist,o(parsedlist)}})}},300))},t.getResource=r.getResource}),bfe.define("src/lookups/rdacontenttype",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://rdaregistry.info/termList/RDAContentType",t.source=function(e,o){console.log("q is "+e),q=encodeURI(e),a[q]?o(a[q]):(void 0!==this.searching&&(clearTimeout(this.searching),o([])),this.searching=setTimeout(function(){if(""===e||" "===e)u=t.scheme+".json-ld",$.ajax({url:u,dataType:"json",success:function(a){return parsedlist=r.processJSONLDSuggestions(a,e,t.scheme),o(parsedlist)}});else{if(!(e.length>1))return[];u=t.scheme+".json-ld",console.log(u),$.ajax({url:u,dataType:"json",success:function(i){return parsedlist=r.processJSONLDSuggestions(i,e,t.scheme),a[q]=parsedlist,o(parsedlist)}})}},300))},t.getResource=r.getResource}),bfe.define("src/lookups/rdafrequency",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://rdaregistry.info/termList/frequency",t.source=function(e,o){console.log("q is "+e),q=encodeURI(e),a[q]?o(a[q]):(void 0!==this.searching&&(clearTimeout(this.searching),o([])),this.searching=setTimeout(function(){if(""===e||" "===e)u=t.scheme+".json-ld",$.ajax({url:u,dataType:"json",success:function(a){return parsedlist=r.processJSONLDSuggestions(a,e,t.scheme),o(parsedlist)}});else{if(!(e.length>1))return[];u=t.scheme+".json-ld",console.log(u),$.ajax({url:u,dataType:"json",success:function(i){return parsedlist=r.processJSONLDSuggestions(i,e,t.scheme),a[q]=parsedlist,o(parsedlist)}})}},300))},t.getResource=r.getResource}),bfe.define("src/lookups/rdaaspectration",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://rdaregistry.info/termList/AspectRatio",t.source=function(e,o){console.log("q is "+e),q=encodeURI(e),a[q]?o(a[q]):(void 0!==this.searching&&(clearTimeout(this.searching),o([])),this.searching=setTimeout(function(){if(""===e||" "===e)u=t.scheme+".json-ld",$.ajax({url:u,dataType:"json",success:function(a){return parsedlist=r.processJSONLDSuggestions(a,e,t.scheme),o(parsedlist)}});else{if(!(e.length>1))return[];u=t.scheme+".json-ld",console.log(u),$.ajax({url:u,dataType:"json",success:function(i){return parsedlist=r.processJSONLDSuggestions(i,e,t.scheme),a[q]=parsedlist,o(parsedlist)}})}},300))},t.getResource=r.getResource}),bfe.define("src/lookups/rdageneration",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://rdaregistry.info/termList/RDAGeneration",t.source=function(e,o){console.log("q is "+e),q=encodeURI(e),a[q]?o(a[q]):(void 0!==this.searching&&(clearTimeout(this.searching),o([])),this.searching=setTimeout(function(){if(""===e||" "===e)u=t.scheme+".json-ld",$.ajax({url:u,dataType:"json",success:function(a){return parsedlist=r.processJSONLDSuggestions(a,e,t.scheme),o(parsedlist)}});else{if(!(e.length>1))return[];u=t.scheme+".json-ld",console.log(u),$.ajax({url:u,dataType:"json",success:function(i){return parsedlist=r.processJSONLDSuggestions(i,e,t.scheme),a[q]=parsedlist,o(parsedlist)}})}},300))},t.getResource=r.getResource}),bfe.define("src/lookups/lcorganizations",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://id.loc.gov/vocabulary/organizations",t.source=function(e,o){return r.simpleQuery(e,a,t.scheme,o)},t.getResource=r.getResourceWithAAP}),bfe.define("src/lookups/relators",["require","exports","module","src/lookups/lcshared"],function(e,t,o){var r=e("src/lookups/lcshared"),a=[];t.scheme="http://id.loc.gov/vocabulary/relators",t.source=function(e,o){return r.simpleQuery(e,a,t.scheme,o)},t.getResource=r.getResource}),bfe.define("src/lib/aceconfig",["require","exports","module"],function(e,t,o){var r=function(){return this}(),a={packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{}};t.set=function(e,t){if(!a.hasOwnProperty(e))throw new Error("Unknown config key: "+e);a[e]=t},t.init=function(i){if(a.packaged=i||e.packaged||o.packaged||r.define&&define.packaged,!r.document)return"";for(var s,d={},n="",l=document.getElementsByTagName("script"),p=0;p<l.length;p++){var c=l[p],u=c.src||c.getAttribute("src");if(u){for(var f=c.attributes,b=0,g=f.length;b<g;b++){var h=f[b];0===h.name.indexOf("data-ace-")&&(d[(s=h.name.replace(/^data-ace-/,""),s.replace(/-(.)/g,function(e,t){return t.toUpperCase()}))]=h.value)}var m=u.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);m&&(n=m[1])}}for(var v in n&&(d.base=d.base||n,d.packaged=!0),d.basePath=d.base,d.workerPath=d.workerPath||d.base,d.modePath=d.modePath||d.base,d.themePath=d.themePath||d.base,delete d.base,d)void 0!==d[v]&&t.set(v,d[v])}}),bfe.require(["src/bfe"],function(e){for(var t in console.log(e),e&&e.aceconfig.init(),window.bfe||(window.bfe={}),e)e.hasOwnProperty(t)&&(bfe[t]=e[t])});